# 上瘾式广告管理系统需求文档

## 项目概述

### 核心目标
基于8个核心用户痛点，设计一个让广告投放管理者"上瘾"的Google Ads多账户管理系统。通过"发现-评估-测试-监控-操作-优化"的上瘾闭环，将用户从繁杂重复操作中解放，让他们感觉像投资组合经理一样掌控100+个Google Ads账户。

### 设计理念
- **即时反馈：** 每个操作都有清晰的数据反馈，让用户看到立即的结果
- **掌控感：** 通过可视化和一键操作，让用户感觉完全掌控复杂的广告投放
- **成就感：** 通过ROSC提升和智能建议采纳，持续给用户正向激励
- **简单化：** 复杂的技术实现对用户透明，只暴露最核心的业务价值

### 设计原则
- **好品味：** 用数据与流程消除特例；统一模型、统一错误体、统一鉴权
- **KISS与实用主义：** 契约先行、事件为核、大任务入队，少即是多
- **一次成型：** 不保留旧端点/旧头/旧路径；最终形态直达（无需历史迁移）

### 架构总览
- **形态：** Cloud Run微服务 + Cloud SQL PostgreSQL（主库：事件与读模型）+ Pub/Sub（事件总线/任务队列）+ Cloud Functions（投影器）+ Secret Manager（密钥）+ API Gateway（统一入口）+ Firestore（UI级缓存）
- **解耦策略：** 命令→事件→投影→读模型；长耗时/高配额动作（浏览器执行/批量Ads操作/AI分析）统一入队

## 用户痛点分析

| 痛点编号 | 用户痛点描述 | 解决策略 |
|---------|-------------|---------|
| 痛点1 | Offer库管理混乱，不知道哪些跑过、哪些没跑、哪些需要放弃 | 可视化看板管理，拖拽式状态流转 |
| 痛点2 | 无法快速评估Offer价值，不知道是否值得投放 | 10秒智能评估，0-100分量化评分 |
| 痛点3 | 评估-仿真-放大流程断裂，操作繁琐 | 一键仿真启动，自动化流程串联 |
| 痛点4 | 100+账户管理混乱，数据分散难以汇总 | 全局视图，按Offer汇总数据 |
| 痛点5 | 多账户操作效率低，重复工作量大 | 批量操作矩阵，一键执行多账户操作 |
| 痛点6 | 风险识别滞后，需要人工每天检查 | AI主动预警，24/7智能监控 |
| 痛点7 | 不知道如何找到相似的高价值Offer | 机会雷达，基于成功案例自动发现 |
| 痛点8 | 广告表现不佳不知如何优化 | 一键诊断，智能优化建议 |

## 服务与边界

### 外部服务
- **billing**：套餐管理与原子计费
- **offer**：Offer生命周期管理
- **siterank**：10秒智能评估分析
- **batchopen**：仿真编排与任务管理
- **adscenter**：Google Ads集成与批量操作（集成数据同步功能）
- **notifications**：统一通知管理与分发
- **console**：后台管理系统
- **frontend**：用户前端界面

### 网关与底座
- **API Gateway**：统一入口 + Firebase Auth直连 + pkg/auth中间件（承载Identity功能）

### 执行器服务
- **browser-exec**：Node.js 22 + Playwright，常驻独立Cloud Run服务

### 共享底座
- **pkg/auth**：Firebase Bearer中间件 + PostgreSQL RLS集成
- **pkg/config**：Secret Manager + STACK环境配置
- **pkg/events**：发布/订阅 + 幂等工具
- **pkg/http**：错误码/限流/重试统一处理
- **pkg/telemetry**：日志/指标/追踪
- **pkg/database**：PostgreSQL连接池 + RLS自动设置
- **pkg/outbox**：Outbox模式实现 + 轮询发布