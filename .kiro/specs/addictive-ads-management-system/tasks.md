# 上瘾式广告管理系统实施计划

## 项目概述

本实施计划基于需求分析和架构决策，采用8个核心微服务的事件驱动架构。通过并行分工最大化开发效率，实现完整的上瘾式广告管理体验。

## 核心架构决策汇总

### 服务精简化决策
- **Identity服务合并**：认证功能合并到API Gateway，使用Firebase Bearer Token
- **Workflow服务删除**：通过事件驱动架构（Pub/Sub + Saga模式）自然实现工作流
- **删除workflow路由，新增notifications路由**：通过事件驱动实现通知分发
- **8个核心服务**：精简架构，专注核心业务价值，避免过度设计

### 技术栈统一决策
- **微服务**：Go + Cloud Run（统一技术栈，降低维护成本）
- **浏览器执行**：Node.js 22 + Playwright（专业浏览器自动化，支持数百用户并发）
- **数据存储**：PostgreSQL（事件存储+读模型）+ Firestore（UI缓存）
- **事件驱动**：Pub/Sub + Cloud Functions（投影器）+ Saga模式（分布式事务）

### 业务体验决策
- **10秒评估SLO**：智能评估必须在10秒内完成，支持降级和缓存
- **原子计费系统**：reserve → commit/release机制确保计费准确性
- **上瘾体验闭环**：发现→评估→测试→监控→操作→优化的完整用户旅程

## 设计原则

### 好品味
- 用数据与流程消除特例
- 统一模型、统一错误体、统一鉴权

### KISS与实用主义
- 契约先行、事件为核、大任务入队
- 少即是多，避免过度设计

### 一次成型
- 不保留旧端点/旧头/旧路径
- 最终形态直达（无需历史迁移）

## 并行分工策略

### 并行分工策略（基于8个核心服务）

**分工原则：** 基于架构决策，删除Identity和Workflow相关任务，专注8个核心服务

- **A组**：API Gateway + 统一认证（合并Identity功能）+ OpenAPI契约
- **B组**：事件存储 + 投影器 + 事件驱动工作流（替代Workflow服务）+ notifications路由
- **C组**：Browser-Exec高并发执行服务（Node.js + Playwright）
- **D组**：Siterank评估服务 + AI预警（SimilarWeb + Firebase AI + 规则引擎）
- **E组**：Batchopen批量操作服务（换链接 + A/B测试 + CPC调整）
- **F组**：Adscenter服务 + 数据同步（Google Ads API + Pre-flight检查）
- **G组**：Billing原子计费 + Notifications通知管理 + Console后台管理
- **H组**：观测性 + SLO监控 + CI/CD部署

---

## A组：API Gateway + 统一认证（合并Identity功能）

### A1. OpenAPI契约与统一认证

- [ ] A1.1 建立OpenAPI规范体系
  - 以.kiro规范输出OpenAPI（所有域）
  - 定义统一的数据模型和错误码
  - 建立API版本管理和兼容性策略
  - 实现API文档自动生成
  - _需求: 需求A1 - OpenAPI契约先行_

- [ ] A1.2 实现代码生成工具链
  - 建立Go server stubs生成器
  - 实现TypeScript客户端SDK生成
  - 建立API Gateway配置渲染
  - 实现契约测试自动生成
  - _需求: 需求A1 - OpenAPI契约先行_

- [ ] A1.3 建立统一路由与错误处理
  - 实现统一路由格式：`/api/v1/{service}/{resource}`
  - 建立202异步模式和任务ID机制
  - 实现统一错误体：`{code, message, details?, traceId}`
  - 建立X-Idempotency-Key幂等处理
  - _需求: 需求A2 - 统一路由与错误处理_

### A2. API Gateway配置与Firebase认证集成

- [ ] A2.1 配置API Gateway统一入口
  - 配置Google Cloud API Gateway作为统一入口
  - 实现路由分发到8个核心微服务
  - 建立限流和监控配置
  - 实现负载均衡规则
  - _需求: 需求13 - 统一认证与访问控制_

- [ ] A2.2 集成Firebase Bearer认证（合并Identity服务功能）
  - 在API Gateway层实现Firebase Bearer Token验证
  - 建立用户上下文注入到后续服务调用
  - 实现Console role=ADMIN权限验证
  - 建立OAuth回调和健康检查白名单免认证
  - 删除独立Identity服务相关代码和配置
  - 实现pkg/auth中间件（简化版）
  - _需求: 需求13 - 统一认证与访问控制_

## B组：事件存储 + 事件驱动工作流（替代Workflow服务）

### B1. 事件存储与工作流基础设施

- [x] B1.1 建立事件存储表结构
  - 创建PostgreSQL事件存储表：event_store
  - 实现事件写入和查询接口
  - 建立事件版本管理和迁移
  - 实现事件快照和归档策略
  - _需求: 需求D1 - 事件存储与投影_

- [ ] B1.2 定义标准事件集与工作流事件
  - 实现UserRegistered、OfferCreated事件
  - 实现SiterankRequested/Completed事件
  - 实现BatchOpsTaskQueued/Started/Completed/Failed事件
  - 实现BrowserExecRequested/Completed事件
  - 实现TokenReserved/Debited/Reverted事件
  - 实现WorkflowStarted/StepCompleted/WorkflowCompleted事件（替代Workflow服务）
  - 实现NotificationCreated/Sent事件（新增notifications路由）
  - _需求: 需求24 - 事件驱动架构与工作流实现_

### B2. 投影器与Saga工作流

- [ ] B2.1 实现投影器框架与Saga模式
  - 建立Cloud Functions投影器模板
  - 实现Pub/Sub事件分发机制
  - 建立Saga协调器处理分布式事务（替代Workflow服务）
  - 实现投影器幂等性和错误处理
  - 实现notifications路由的事件驱动通知分发
  - _需求: 需求24 - 事件驱动架构与工作流实现_
  - 实现读模型更新和同步
  - _需求: 需求D1 - 事件存储与投影_

- [x] B2.2 建立读模型表结构
  - 创建User、Offer、SiterankAnalysis、BatchopenTask表
  - 创建UserAdsConnection、Subscription、UserToken表
  - 创建TokenTransaction、AuditSnapshot表
  - 实现统一迁移脚本一次到位
  - _需求: 需求D2 - 读模型与缓存策略_

- [ ] B2.3 实现Firestore缓存策略
  - 建立Firestore作为UI实时缓存层
  - 实现与SQL投影同步写入
  - 确保"SQL为事实来源"的架构
  - 建立缓存失效和更新机制
  - _需求: 需求D2 - 读模型与缓存策略_

## C组：Browser-Exec高并发执行服务

### C1. Browser-Exec服务

- [x] C1.1 建立Node.js服务架构
  - 创建Node.js 22 + Playwright项目结构
  - 实现浏览器池管理和并发控制
  - 建立代理池管理（租借/归还/失败隔离）
  - 实现Cloud Run最小实例>0预热策略
  - _需求: 需求C2 - Browser-Exec服务_

- [x] C1.2 实现核心API能力
  - 实现/parse-url：URL解析和品牌提取
  - 实现/check-availability：落地页可用性检测
  - 实现/simulate-click：点击仿真
  - 实现/batch-execute：批量执行
  - _需求: 需求C2 - Browser-Exec服务_

- [ ] C1.3 实现资源管理和监控
  - 建立浏览器池并发与内存护栏
  - 实现指数退避与隔离机制
  - 建立IAM受限的服务间调用
  - 实现资源监控和性能指标
  - _需求: 需求C2 - Browser-Exec服务_

## E组：Batchopen批量操作服务

### E1. Batchopen仿真编排

- [ ] E1.1 实现仿真模板系统
  - 建立国家曲线/UA/Referer/时区模板
  - 实现命令入队和进度追踪
  - 建立质量评分机制
  - 实现失败重试分级
  - _需求: 需求C4 - Batchopen仿真编排_

- [ ] E1.2 集成Browser-Exec执行
  - 实现执行下沉至Browser-Exec
  - 建立与Billing服务的计费集成
  - 实现任务状态追踪和通知
  - 建立批量处理优化
  - _需求: 需求C4 - Batchopen仿真编排_

## D组：Siterank（10秒评估）

### D1. 评估流程实现

- [x] D1.1 建立10秒评估流程
  - 实现Browser-Exec解析URL/品牌
  - 集成SimilarWeb API拉取数据
  - 建立评分器（权重表+阈值，KISS）
  - 实现SiterankCompleted事件发布
  - _需求: 需求C1 - Siterank 10秒评估_

- [x] D1.5 SimilarWeb域名数据全局缓存（7天/1天）
  - 成功返回缓存7天，失败返回缓存1天
  - 以域名host为key建立全局缓存（PostgreSQL表：domain_cache）
  - 服务实例共享缓存，无需用户层面的数据隔离
  - 已在siterank服务接入（优先命中缓存，否则回源SimilarWeb并回写缓存）
  - _需求: 需求C1 - Siterank 10秒评估_

- [ ] D1.2 实现性能优化策略
  - 建立并行拉取机制
  - 实现超时分段处理
  - 建立域名+国家缓存
  - 实现降级策略和错误恢复
  - _需求: 需求C1 - Siterank 10秒评估_

- [ ] D1.3 实现评估结果投影
  - 建立评估结果投影到读模型
  - 实现通过投影/通知更新前端
  - 建立评估历史和趋势分析
  - 实现相似机会发现算法
  - _需求: 需求C1 - Siterank 10秒评估_

- [ ] D1.4 实现简化增强功能
  - 实现深度相似度算法：域名关键词匹配30分+流量规模相似性25分+国家重叠度20分+行业分类匹配25分
  - 集成Google Ads关键词规划师API，实现关键词扩展建议功能
  - 建立简单过滤机制：搜索量>1000且竞争度非HIGH
  - 实现相似度评分详情和推荐理由展示
  - _需求: 需求C7 - 机会发现增强_

## E组：Adscenter（Pre-flight/批量矩阵）

### E1. Pre-flight诊断系统

- [ ] E1.1 实现结构化诊断
  - 建立Pre-flight检查项：环境/授权/结构/余额/回传/落地/API可达性
  - 实现结构化输出：code/severity/message/details/summary
  - 建立validate-only预检模式
  - 实现诊断结果缓存和优化
  - _需求: 需求C3 - Adscenter诊断+批量_

### E2. 批量操作矩阵

- [ ] E2.1 实现批量操作流程
  - 建立"变更计划"提交机制
  - 实现validate-only预检
  - 建立入队执行（队列/限流/退避）
  - 实现审计快照（前后对比）和回滚支持
  - _需求: 需求C3 - Adscenter诊断+批量_

- [ ] E2.2 实现MCC链接管理
  - 建立MCC链接状态机（invited/pending/active/inactive）
  - 实现刷新令牌加密存储
  - 建立state HMAC和回调域白名单
  - 实现配额策略配置化管理
  - _需求: 需求C3 - Adscenter诊断+批量_

- [ ] E2.3 实现精细化诊断和操作指导系统
  - 建立预定义诊断规则库：无曝光问题、低CTR问题等规则
  - 实现基于Google Ads API质量得分的规则匹配引擎
  - 建立操作模板库：提高CPC、暂停低质量关键词、扩展匹配类型等
  - 实现一键执行功能和效果预估
  - 建立操作历史记录和效果跟踪
  - _需求: 需求8 - 广告诊断与优化系统增强_

## F组：Billing（reserve/commit/release）

### F1. 原子计费系统

- [ ] F1.1 实现原子扣费机制
  - 建立reserve(n) → 成功commit(n) / 失败release(n)机制
  - 实现扣费点：评估、仿真、批量操作
  - 建立事务消息和补偿机制
  - 实现Token余额和预留管理
  - _需求: 需求C5 - Billing原子计费_

- [ ] F1.2 实现计费配置和明细
  - 建立价格/限额集中配置（只读下发）
  - 实现动作/对象/任务/事件链路追溯
  - 建立计费明细和交易记录
  - 实现事件驱动的读模型更新
  - _需求: 需求C5 - Billing原子计费_

## G组：Billing原子计费 + Notifications通知管理 + Console后台管理

### G1. Billing原子计费系统

- [ ] G1.1 实现原子扣费机制
  - 建立reserve(n) → 成功commit(n) / 失败release(n)机制
  - 实现扣费点：评估、仿真、批量操作
  - 建立事务消息和补偿机制
  - 实现Token余额和预留管理
  - _需求: 需求C5 - Billing原子计费_

- [ ] G1.2 实现计费配置和明细
  - 建立价格/限额集中配置（只读下发）
  - 实现动作/对象/任务/事件链路追溯
  - 建立计费明细和交易记录
  - 实现事件驱动的读模型更新
  - _需求: 需求C5 - Billing原子计费_

### G2. Notifications通知管理系统

- [ ] G2.1 建立通知服务基础架构
  - 创建独立的Notification Service (Cloud Run)
  - 建立PostgreSQL通知表结构（user_notifications、notification_rules）
  - 实现Firestore实时缓存结构（最近30天通知）
  - 建立分层存储策略（实时缓存+历史存储）
  - 实现用户数据严格隔离机制（按user_id强制隔离）
  - _需求: 需求C8 - 统一通知管理系统_

- [ ] G2.2 实现通知规则引擎和事件监听
  - 建立事件驱动的通知规则引擎
  - 集成现有Pub/Sub事件总线，监听业务事件
  - 实现事件到通知的转换逻辑
  - 建立通知创建和存储服务
  - 实现通知分发器（支持应用内通知）
  - _需求: 需求C8 - 统一通知管理系统_

### G3. Console后台管理

- [ ] G3.1 实现Console管理界面
  - 建立管理员仪表盘和统计
  - 实现用户管理和权限控制
  - 建立套餐管理和Token充值
  - 实现系统配置和监控界面
  - 建立通知规则配置管理
  - _需求: 需求12 - 后台管理系统_

## H组：观测/SLO/告警 + CI/CD

### H1. 可观测性系统

- [ ] H1.1 实现结构化日志
  - 建立JSON格式日志：trace_id、user_id、offer_id、task_id、stack、service、version
  - 实现异常日志包含code与堆栈摘要
  - 建立OpenTelemetry分布式追踪
  - 实现每服务/healthz端点和Gateway /api/health聚合
  - _需求: 需求O1 - 结构化日志与追踪_

- [ ] H1.2 实现SLO监控和告警
  - 建立关键指标P95：评估≤10s、仿真入队≤1s、Pre-flight≤800ms、批量成功率≥99%、浏览器执行错误率≤1%
  - 实现按stack/service维度配置告警
  - 建立性能趋势分析和容量规划
  - 实现故障定位和恢复机制
  - _需求: 需求O2 - 关键指标与SLO_

### H2. CI/CD与环境管理

- [ ] H2.1 实现环境隔离
  - 建立STACK=dev|preview|prod环境策略
  - 实现{service}-{stack}命名规范
  - 建立资源标签隔离（autoads-stack=dev|preview|prod）
  - 实现按环境的Secret管理
  - _需求: 需求E1 - 环境隔离与配置_

- [ ] H2.2 实现性能和成本优化
  - 建立Browser-Exec独立镜像和扩缩容
  - 实现Ads API的validate-only预检+限流/退避+批量分片
  - 建立Siterank（域名+国家）与OAuth配置缓存
  - 实现Pre-flight结果短缓存助力P95达标
  - _需求: 需求E2 - 性能与成本优化_

### 1. 共享底座开发 (pkg/*)

- [ ] 1.1 实现认证中间件 (pkg/auth)
  - 实现Firebase Bearer Token验证中间件
  - 建立用户上下文注入和权限检查
  - 实现JWT Token解析和验证
  - 建立统一的认证错误处理
  - _需求: 需求26 - 企业级安全与治理_

- [ ] 1.2 实现配置管理 (pkg/config)
  - 实现Secret Manager集成和KMS加密
  - 建立环境栈配置(STACK=dev|staging|prod)
  - 实现配置热加载和缓存机制
  - 建立配置验证和默认值处理
  - _需求: 需求26 - 企业级安全与治理_

- [ ] 1.3 实现事件系统 (pkg/events)
  - 实现事件发布/订阅装饰器
  - 建立幂等性管理(X-Idempotency-Key)
  - 实现事件序列化和反序列化
  - 建立事件版本管理和兼容性
  - _需求: 需求24 - 事件驱动架构与CQRS_

- [ ] 1.4 实现HTTP客户端 (pkg/http)
  - 实现统一错误码和响应格式
  - 建立重试策略和指数退避
  - 实现限流和熔断机制
  - 建立请求追踪和日志记录
  - _需求: 需求27 - 可观测性与SLO_

- [ ] 1.5 实现可观测性 (pkg/telemetry)
  - 实现结构化日志(JSON格式)
  - 建立指标收集和上报(Prometheus格式)
  - 实现OpenTelemetry分布式追踪
  - 建立健康检查和监控端点
  - _需求: 需求27 - 可观测性与SLO_

### 2. OpenAPI契约与代码生成

- [ ] 2.1 建立OpenAPI规范
  - 定义所有微服务的OpenAPI 3.0规范
  - 建立统一的数据模型和错误码
  - 实现API版本管理和兼容性策略
  - 建立API文档自动生成
  - _需求: 需求24 - 事件驱动架构与CQRS_

- [ ] 2.2 实现代码生成工具
  - 建立Go服务端代码生成器
  - 实现TypeScript客户端SDK生成
  - 建立API Gateway配置渲染
  - 实现契约测试自动生成
  - _需求: 需求24 - 事件驱动架构与CQRS_

- [x] 2.3 建立API Gateway配置
  - 配置Google Cloud API Gateway
  - 实现统一认证和授权策略
  - 建立限流和监控配置
  - 实现路由和负载均衡规则
  - _需求: 需求26 - 企业级安全与治理_

### 3. 事件存储与投影系统

- [ ] 3.1 建立事件存储基础设施
  - 创建PostgreSQL事件存储表结构
  - 实现事件写入和查询接口
  - 建立事件版本管理和迁移
  - 实现事件快照和归档策略
  - _需求: 需求24 - 事件驱动架构与CQRS_

- [ ] 3.2 实现投影器框架
  - 建立Cloud Functions投影器模板
  - 实现Pub/Sub事件分发机制
  - 建立投影器幂等性和错误处理
  - 实现读模型更新和同步
  - _需求: 需求24 - 事件驱动架构与CQRS_

- [ ] 3.3 建立CI/CD流水线
  - 实现单repo多服务构建缓存
  - 建立分服务发布和部署
  - 实现环境隔离和Secret管理
  - 建立自动化测试和质量门禁
  - _需求: 需求26 - 企业级安全与治理_

## M1: MVP闭环 (4-6周)

### 4. 核心微服务实现

- [ ] 4.1 实现Identity服务
  - 建立用户注册、登录、认证API
  - 实现Firebase Auth集成和Token管理
  - 建立用户权限和角色管理
  - 实现用户事件发布(UserRegistered等)
  - _需求: 需求13 - 用户认证与访问控制_

- [ ] 4.2 实现Billing服务
  - 建立双分录账本模型(balance/hold/expense)
  - 实现原子扣费机制(reserve/commit/release)
  - 建立Token事件发布和处理
  - 实现事务消息和补偿机制
  - _需求: 需求25 - 原子计费与Token管理_

- [ ] 4.3 实现Offer服务
  - 建立Offer CRUD和状态管理
  - 实现Offer事件发布(OfferCreated等)
  - 建立状态流转和自动转换规则
  - 实现批量Offer创建和管理
  - _需求: 需求1 - Offer生命周期可视化管理_

### 5. 高并发浏览器执行服务 (Browser-Exec)

- [ ] 5.1 建立分层架构基础
  - 创建Node.js 22 + Express + Redis分层架构
  - 实现API Gateway层：请求路由、负载均衡、限流
  - 建立Task Queue层：Redis Cluster多队列管理
  - 实现Browser Pool Manager：浏览器池管理和任务调度
  - 配置Cloud Run弹性扩缩容：最小2实例，最大50实例
  - _需求: 需求15 - 高并发浏览器执行服务_

- [ ] 5.2 实现智能任务调度系统
  - 建立TaskScheduler：支持优先级队列和批量处理
  - 实现LoadBalancer：按地理位置、负载、任务类型智能分配
  - 建立任务重试和故障转移机制
  - 实现任务状态追踪和WebSocket实时通知
  - 建立容量监控和自动扩缩容策略
  - _需求: 需求15 - 高并发浏览器执行服务_

- [ ] 5.3 实现浏览器池管理系统
  - 建立BrowserPoolManager：支持多池管理和实例隔离
  - 实现BrowserContext隔离：避免任务间污染
  - 建立浏览器实例预热和回收策略
  - 实现资源监控：内存、CPU、并发数实时监控
  - 建立性能优化：批量处理、连接复用、缓存策略
  - _需求: 需求15 - 高并发浏览器执行服务_

- [ ] 5.4 实现核心业务处理能力
  - 实现URL解析模块：多重重定向处理，支持批量解析
  - 建立品牌识别模块：智能域名品牌提取算法
  - 实现可用性探测：落地页健康检测和异常识别
  - 建立点击仿真模块：真实用户行为模拟和反检测
  - 实现代理池管理：按国家/质量维度，失败隔离和指数退避
  - _需求: 需求15 - 高并发浏览器执行服务_

- [ ] 5.5 实现监控和运维系统
  - 建立MetricsCollector：任务执行指标、成功率、响应时间
  - 实现HealthChecker：实例健康检查和故障检测
  - 建立告警系统：容量预警、性能异常、故障通知
  - 实现运维工具：手动扩缩容、维护模式、配置热更新
  - 建立性能基准：单实例100-200任务/分钟，集群2000-10000任务/分钟
  - _需求: 需求15 - 高并发浏览器执行服务_

### 6. Siterank评估服务

- [ ] 6.1 实现10秒评估SLO
  - 建立分阶段评估流程(域名→SimilarWeb→评分)
  - 实现并行处理和结果缓存
  - 建立评估进度追踪和通知
  - 实现超时降级和错误处理
  - _需求: 需求2 - 智能Offer评估系统_

- [ ] 6.2 集成外部API
  - 实现SimilarWeb API集成和数据解析
  - 建立Firebase AI Logic内容分析
  - 实现浏览器执行服务调用
  - 建立API限流和错误重试
  - _需求: 需求2 - 智能Offer评估系统_

- [ ] 6.3 实现评估事件流
  - 发布SiterankRequested/Completed事件
  - 实现评估结果投影到读模型
  - 建立评估历史和趋势分析
  - 实现相似机会发现算法
  - _需求: 需求2 - 智能Offer评估系统_

### 7. 前端MVP实现

- [ ] 7.1 建立前端基础架构
  - 创建用户前端项目(Next.js 14 + Tailwind CSS)
  - 创建管理后台项目(Next.js 14 + Ant Design)
  - 实现OpenAPI生成的TypeScript SDK集成
  - 建立统一的状态管理和错误处理
  - _需求: 需求14 - 前端UI/UX优化_

- [ ] 7.2 实现核心业务闭环界面
  - 实现Offer指挥中心看板(拖拽状态流转)
  - 建立10秒评估界面(进度条+阶段反馈)
  - 实现仿真启动和进度监控界面
  - 建立通知和预警展示组件
  - _需求: 需求1,2,3 - 核心业务闭环_

### 8. 高并发性能测试与验证

- [ ] 8.1 浏览器执行服务并发测试
  - 测试单实例8-12个浏览器并发处理能力
  - 验证集群2-50个实例弹性扩缩容机制
  - 测试数百用户同时提交任务的处理能力
  - 验证任务队列在高并发下的稳定性和优先级调度
  - 测试浏览器池在高负载下的资源管理和回收
  - _需求: 需求15 - 高并发浏览器执行服务_

- [ ] 8.2 端到端闭环性能测试
  - 测试Offer创建→评估→仿真→通知完整流程在高并发下的表现
  - 验证10秒评估SLO在数百并发请求下的达成率
  - 测试事件流和数据一致性在高并发场景下的可靠性
  - 验证原子扣费和补偿机制在并发冲突下的正确性
  - 建立性能基准：2000-10000任务/分钟处理能力
  - _需求: 需求27 - 可观测性与SLO_

- [ ] 8.3 容量规划和成本优化验证
  - 验证容量规划模型：单实例配置vs处理能力的线性关系
  - 测试成本优化策略：智能调度、资源复用的成本效益
  - 验证监控告警：容量预警、性能异常检测的准确性
  - 测试故障恢复：实例故障、任务重试、降级处理的有效性
  - 建立运维手册：扩缩容策略、故障排查、性能调优指南
  - _需求: 需求27 - 可观测性与SLO_

## M2: 功能强化 (4-6周)

### 9. Adscenter服务 (广告中心)

- [ ] 9.1 实现Google Ads集成
  - 建立OAuth 2.0认证和Token管理
  - 实现AES-GCM加密存储和轮换策略
  - 建立Live/Stub模式分离(build tag)
  - 实现MCC链接状态机管理
  - _需求: 需求16 - Google Ads账号授权与关联管理_

- [ ] 9.2 实现Pre-flight检查
  - 建立validate-only预检机制
  - 实现配额和限流控制
  - 建立审计快照和差异对比
  - 实现Pre-flight事件发布
  - _需求: 需求8 - 广告诊断与优化系统_

### 10. Batchopen服务 (批量操作)

- [ ] 10.1 实现批量操作矩阵
  - 建立变更计划创建和预览
  - 实现干跑验证和风险评估
  - 建立批量执行和进度追踪
  - 实现局部回滚和重试机制
  - _需求: 需求5 - 批量操作管理系统_

- [ ] 10.2 实现A/B测试MVP
  - 建立广告组复制和流量分配
  - 实现A/B测试事件追踪
  - 建立统计显著性分析
  - 实现获胜版本推荐机制
  - _需求: 需求5 - 批量操作管理系统_

### 11. Workflow服务 (工作流编排)

- [ ] 11.1 实现业务流程编排
  - 建立工作流定义和状态机
  - 实现流程启动、暂停、恢复、取消
  - 建立流程事件发布和追踪
  - 实现流程超时和异常处理
  - _需求: 需求17 - 定时任务管理系统_

- [ ] 11.2 实现Risk Engine基础
  - 建立风险规则引擎和配置
  - 实现低曝光低点击检测
  - 建立落地页不可用监控
  - 实现风险事件发布和处理
  - _需求: 需求6 - AI智能预警与优化建议_

### 12. 国际化与SEO系统

- [ ] 12.1 实现多语言支持
  - 建立next-i18next国际化框架
  - 实现中英双语翻译管理
  - 建立多语言AI提示词模板
  - 实现语言切换和自动检测
  - _需求: 需求22 - 国际化与多语言支持_

- [ ] 12.2 实现SEO优化
  - 建立多语言站点地图生成
  - 实现结构化数据和Open Graph
  - 建立hreflang标签和语言路由
  - 实现SEO元数据管理
  - _需求: 需求23 - SEO优化与站点地图_

## M2.5: 简化功能增强 (1-2周)

### 15. 痛点7&8增强实施

- [ ] 15.1 Siterank服务增强
  - 在现有Siterank服务中添加简化相似度算法
  - 实现域名关键词匹配、流量规模相似性、国家重叠度、行业分类匹配四个维度评分
  - 集成Google Ads关键词规划师API
  - 实现关键词扩展建议功能，过滤搜索量>1000且竞争度非HIGH的关键词
  - _需求: 需求C7 - 机会发现增强_

- [ ] 15.2 Adscenter服务诊断增强
  - 在现有Adscenter服务中添加诊断规则引擎
  - 建立预定义诊断规则库（无曝光、低CTR等）
  - 实现操作模板库和一键执行功能
  - 建立效果预估和操作历史跟踪
  - _需求: 需求8 - 广告诊断与优化系统增强_

- [ ] 15.3 前端界面增强
  - 在Offer详情页面添加相似机会展示模块
  - 实现相似度评分详情和推荐理由展示
  - 在广告管理界面添加一键诊断按钮
  - 实现诊断结果展示和一键优化操作界面
  - _需求: 前端增强需求_

## M3: 生产级打磨 (3-4周)

### 13. 性能优化与监控

- [ ] 13.1 实现完整监控体系
  - 建立SLO监控和告警规则
  - 实现分布式追踪和性能分析
  - 建立容量规划和扩缩容策略
  - 实现成本优化和资源管理
  - _需求: 需求27 - 可观测性与SLO_

- [ ] 13.2 实现安全加固
  - 建立密钥轮换和安全演练
  - 实现访问控制和审计日志
  - 建立数据隔离和合规检查
  - 实现安全扫描和漏洞修复
  - _需求: 需求26 - 企业级安全与治理_

### 14. 运维工具与故障演练

- [ ] 14.1 建立运维工具集
  - 实现蓝绿/金丝雀部署策略
  - 建立配置开关和Feature Flag
  - 实现故障注入和混沌工程
  - 建立运维手册和应急预案
  - _需求: 需求26 - 企业级安全与治理_

- [ ] 14.2 实现策略库和报表
  - 建立策略模板和最佳实践库
  - 实现国家曲线编辑器
  - 建立运营报表和数据分析
  - 实现用户行为分析和优化建议
  - _需求: 需求7 - 机会发现与扩展系统_
  - 实现权限检查中间件
  - 建立API访问控制
  - _需求: 需求11 - 套餐管理与订阅系统_

- [ ] 3.3 实现Google Ads OAuth集成
  - 配置Google Ads API OAuth流程
  - 实现账号授权和Token管理
  - 建立账号关联和状态管理
  - _需求: 需求16 - Google Ads账号授权与关联管理_

---

## 第二阶段：核心业务功能

### 4. Offer管理服务

- [ ] 4.1 实现Offer CRUD操作
  - 创建Offer管理服务基础架构
  - 实现Offer创建、查询、更新、删除API
  - 建立Offer状态管理和流转逻辑
  - 实现批量录入功能
  - _需求: 需求1 - Offer生命周期可视化管理_

- [ ] 4.2 实现Offer状态自动转换
  - 实现连续5天0曝光0点击检测逻辑
  - 实现ROSC连续下滑检测
  - 建立自动状态转换机制
  - 实现状态变更通知系统
  - _需求: 需求1 - Offer生命周期可视化管理_

- [ ] 4.3 实现ROSC计算和历史记录
  - 建立ROSC计算引擎
  - 实现历史数据存储和查询
  - 创建趋势分析功能
  - _需求: 需求4 - 全局多账户管理视图_

### 5. 浏览器执行服务(常驻服务)

- [ ] 5.1 建立浏览器实例池管理
  - 实现Playwright浏览器实例池
  - 建立实例生命周期管理
  - 实现并发请求处理
  - _需求: 需求15 - 浏览器执行服务_

- [ ] 5.2 实现智能代理IP管理
  - 建立代理IP池管理系统
  - 实现智能复用策略(相同国家5分钟复用)
  - 确保同一Offer URL使用不重复IP
  - 实现代理IP API集成和轮换
  - _需求: 需求15 - 浏览器执行服务_

- [ ] 5.3 实现核心功能模块
  - 实现URL解析模块(多重重定向处理、Final URL和suffix提取)
  - 建立品牌识别模块(从域名提取品牌名)
  - 实现页面分析模块(获取页面内容用于AI分析)
  - 建立点击仿真模块(真实浏览器访问)
  - 实现可用性监控模块(落地页健康检测)
  - 建立反检测策略和地域化配置
  - _需求: 需求15 - 浏览器执行服务_

### 6. 智能评估分析服务

- [ ] 6.1 实现SimilarWeb API集成
  - 配置SimilarWeb API客户端
  - 实现流量数据获取和分析
  - 建立数据缓存机制
  - _需求: 需求2 - 智能Offer评估系统_

- [ ] 6.2 实现Firebase AI Logic集成
  - 配置Firebase AI Logic客户端
  - 实现内容分析功能(落地页分析、产品分类)
  - 实现优化建议生成
  - 实现合规性检查
  - _需求: 需求2 - 智能Offer评估系统_

- [ ] 6.3 实现评估算法和评分系统
  - 建立0-100分评分算法
  - 实现五维度评估(流量潜力、关键词精准度、CPC成本、合规风险、季节性机会)
  - 集成浏览器执行服务获取落地页域名和品牌名
  - 实现季节性波动分析
  - 建立市场机会窗口识别
  - _需求: 需求2 - 智能Offer评估系统_

### 7. 前端核心界面开发

- [ ] 7.1 建立双栈前端架构
  - 创建用户前端项目(Next.js 14 + Tailwind CSS + Headless UI)
  - 创建后台管理项目(Next.js 14 + Ant Design 5.x)
  - 建立共享包结构(shared-types, api-client, utils)
  - 配置状态管理(Zustand + React Query)
  - 配置Firebase SDK集成
  - _需求: 需求14 - 前端UI/UX优化_

- [ ] 7.2 实现Offer指挥中心界面
  - 创建看板式视图组件
  - 实现拖拽交互(@dnd-kit/core)
  - 建立Offer卡片组件和状态显示
  - 实现实时数据同步
  - _需求: 需求1 - Offer生命周期可视化管理_

- [ ] 7.3 实现智能评估界面
  - 创建评估输入组件
  - 实现进度条和动画效果
  - 建立评分雷达图显示
  - 实现成功音效和视觉反馈
  - _需求: 需求2 - 智能Offer评估系统_

- [ ] 7.4 实现后台管理界面
  - 创建管理员仪表盘(Ant Design)
  - 实现用户管理界面(表格、筛选、批量操作)
  - 建立套餐管理界面(表单、权限配置)
  - 实现Token管理界面(统计、充值、规则配置)
  - 建立API监控界面(调用统计、配额管理、预警)
  - 实现点击分析界面(真实性分析、策略优化)
  - 建立系统监控界面(异常事件、定时任务执行结果)
  - _需求: 需求12 - 后台管理系统_

- [ ] 7.5 实现移动端适配优化
  - 优化用户前端的移动端响应式设计
  - 实现触摸友好的交互组件(拖拽、滑动)
  - 优化移动端的Offer指挥中心操作体验
  - 建立PWA支持和离线功能
  - 优化移动端的数据可视化组件
  - _需求: 需求14 - 前端UI/UX优化_

---

## 第三阶段：高级功能与集成

### 8. 批量操作服务

- [ ] 8.1 实现以Offer为中心的批量操作
  - 建立Offer到Google Ads账户的关联查询
  - 实现批量操作矩阵界面
  - 建立操作预览和确认机制
  - _需求: 需求5 - 批量操作管理系统_

- [ ] 8.2 实现换链接功能
  - 建立定时换链接任务
  - 集成浏览器执行服务预获取Final URL和suffix
  - 建立Google Ads API批量更新
  - 实现操作历史记录和回滚
  - _需求: 需求5 - 批量操作管理系统_

- [ ] 8.3 实现A/B测试功能(Max/Elite套餐)
  - 建立A/B测试创建和管理
  - 实现流量分配和数据跟踪
  - 建立统计显著性分析
  - 实现获胜版本推荐
  - _需求: 需求5 - 批量操作管理系统_

### 9. 定时任务系统

- [ ] 9.1 建立Cloud Scheduler + Pub/Sub架构
  - 配置Cloud Scheduler作业
  - 建立Pub/Sub主题和订阅
  - 实现Cloud Functions任务执行器
  - _需求: 需求17 - 定时任务管理系统_

- [ ] 9.2 实现补点击任务系统
  - 建立补点击任务配置和管理
  - 实现点击分布模型(工作日、周末、节假日)
  - 集成浏览器执行服务实现真实浏览器访问
  - 建立自定义模型拖拽界面
  - 实现任务执行和进度监控
  - _需求: 需求3 - 一键仿真启动系统_

- [ ] 9.3 实现数据同步任务
  - 建立Google Ads API数据同步
  - 实现增量同步和API限制管理
  - 建立数据质量监控
  - 实现自动状态转换检查
  - _需求: 需求17 - 定时任务管理系统_

### 10. AI预警与优化服务

- [ ] 10.1 实现增强智能预警系统
  - 建立业务风险识别(账号封禁、认证触发、广告费不足等)
  - 建立系统运行风险识别(补点击失败、换链接失败、点击模式偏离等)
  - 实现分类预警和处理策略
  - 建立实时数据监控
  - 实现风险识别规则引擎
  - 建立AI洞察信息流
  - 实现预警通知推送
  - _需求: 需求6 - AI智能预警与优化建议_

- [ ] 10.2 实现机会发现系统
  - 建立机会雷达模块
  - 实现相似网站发现(SimilarWeb API)
  - 建立关键词和受众扩展建议
  - 实现一键添加到机会池
  - _需求: 需求7 - 机会发现与扩展系统_

- [ ] 10.3 实现广告诊断系统
  - 建立一键诊断功能
  - 实现多维度问题分析
  - 建立优化建议生成
  - 实现一键修复操作
  - _需求: 需求8 - 广告诊断与优化系统_

### 11. 后台管理系统

- [ ] 11.1 实现管理员仪表盘
  - 建立实时统计数据聚合
  - 实现用户、收入、系统状态监控
  - 创建图表和趋势分析界面
  - _需求: 需求12 - 后台管理系统_

- [ ] 11.2 实现用户管理功能
  - 建立用户列表和搜索筛选
  - 实现用户详情查看和状态管理
  - 建立套餐变更和Token充值
  - 实现操作日志和审计
  - _需求: 需求12 - 后台管理系统_

- [ ] 11.3 实现套餐和Token管理
  - 建立套餐创建和权限配置
  - 实现Token消耗规则管理
  - 建立批量充值和异常监控
  - _需求: 需求12 - 后台管理系统_

- [ ] 11.4 实现动态配置系统
  - 建立配置热更新机制
  - 实现可视化配置编辑器
  - 建立配置版本管理和回滚
  - 实现实时配置推送
  - _需求: 需求20 - 动态配置管理系统_

- [ ] 11.5 实现API调用监控系统
  - 建立Google Ads API调用统计和监控
  - 实现每日15000次限制的配额管理
  - 建立API调用频率自适应调整
  - 实现API使用预警和限流机制
  - _需求: 需求12 - 后台管理系统_

- [ ] 11.6 实现点击真实性分析系统
  - 建立AI驱动的点击模式分析
  - 实现点击真实性评分算法
  - 建立点击策略优化引擎
  - 实现优化策略到浏览器执行服务的实时推送
  - _需求: 需求12 - 后台管理系统_

- [ ] 11.7 实现系统监控功能
  - 建立系统异常事件记录和分类
  - 实现定时任务执行日志管理
  - 建立异常事件查看和处理界面
  - 实现任务执行结果统计和分析
  - _需求: 需求12 - 后台管理系统_

### 12. 国际化与SEO系统

- [ ] 12.1 实现多语言支持系统
  - 建立next-i18next国际化框架
  - 实现中英双语翻译文件管理
  - 建立语言切换和自动检测
  - 实现多语言AI提示词模板
  - _需求: 需求22 - 国际化与多语言支持_

- [ ] 12.2 实现SEO优化系统
  - 建立next-seo元数据管理
  - 实现多语言站点地图生成
  - 建立结构化数据和Open Graph支持
  - 实现hreflang标签和语言路由
  - _需求: 需求23 - SEO优化与站点地图_

- [ ] 12.3 更新系统页面内容
  - 重新设计/about、/contact、/privacy、/terms页面
  - 实现页面内容的多语言版本
  - 优化页面SEO元数据和结构
  - 确保内容与最新产品设计一致
  - _需求: 需求21 - 系统页面内容管理_
  - 建立AI驱动的点击模式分析
  - 实现点击真实性评分算法
  - 建立点击策略优化引擎
  - 实现优化策略到URL解析服务的实时推送
  - _需求: 需求12 - 后台管理系统_

---

## 第四阶段：测试优化与部署

### 13. 测试体系建设

- [ ] 13.1 建立单元测试框架
  - 为所有Go服务编写单元测试
  - 实现测试覆盖率监控(目标80%+)
  - 建立Mock和测试数据管理
  - _需求: 需求19 - 测试策略与质量保证_

- [ ] 13.2 实现端到端测试
  - 使用Playwright建立E2E测试
  - 覆盖关键用户流程(Offer生命周期、批量操作)
  - 建立测试数据准备和清理
  - _需求: 需求19 - 测试策略与质量保证_

- [ ] 13.3 实现性能测试
  - 使用k6建立负载测试
  - 验证100+账户数据加载性能
  - 测试1000并发用户访问能力
  - 建立性能基准和监控
  - _需求: 需求19 - 测试策略与质量保证_

### 14. 系统优化与安全加固

- [ ] 14.1 实现缓存优化策略
  - 建立Redis缓存层
  - 实现评估结果缓存
  - 优化数据库查询性能
  - _需求: 需求10 - 系统性能与可扩展性_

- [ ] 14.2 加强安全防护
  - 实现API限流和防护
  - 加强数据加密和传输安全
  - 建立安全审计和监控
  - _需求: 需求9 - 数据安全与合规管理_

- [ ] 14.3 实现监控告警系统
  - 集成Google Cloud Monitoring
  - 建立应用性能监控(APM)
  - 实现错误追踪和日志分析
  - 建立告警通知机制
  - _需求: 需求10 - 系统性能与可扩展性_

### 15. 生产环境部署

- [ ] 15.1 配置生产环境基础设施
  - 建立生产环境Cloud Run服务
  - 配置负载均衡和自动扩缩容
  - 建立数据库备份和恢复策略
  - _需求: 需求10 - 系统性能与可扩展性_

- [ ] 15.2 实现部署流水线
  - 配置自动化部署流程
  - 建立蓝绿部署策略
  - 实现健康检查和回滚机制
  - _需求: 需求18 - 技术栈优化与扩展_

- [ ] 15.3 进行生产环境验证
  - 执行完整的系统测试
  - 验证所有功能模块正常运行
  - 进行性能和安全测试
  - 建立运维监控和支持流程
  - _需求: 需求19 - 测试策略与质量保证_

---

## 任务执行指南

### 优先级说明
- **P0 (关键)**: 系统核心功能，必须优先完成
- **P1 (重要)**: 主要业务功能，按计划完成  
- **P2 (一般)**: 增强功能，可适当调整时间

### 依赖关系
- 第一阶段任务是后续阶段的基础，必须按顺序完成
- 浏览器执行服务需要优先部署，其他服务依赖它提供Web交互能力
- 前端开发可以与后端服务并行进行
- 测试任务应该与功能开发同步进行

## 验收门槛

### 契约与认证验收
- **OpenAPI契约测试**：100%通过，确保实现与规范一致
- **受保护路由**：仅Firebase Bearer Token可访问，401/403错误正确返回
- **统一错误体**：所有错误响应符合`{code, message, details?, traceId}`格式
- **幂等处理**：所有变更型POST支持X-Idempotency-Key

### 事件与数据验收
- **事件→投影→读模型一致性**：测试通过（含回放与幂等）
- **事件存储完整性**：所有标准事件正确存储和索引
- **投影器幂等性**：基于事件id/版本的幂等处理正确
- **读模型同步**：SQL事实来源与Firestore UI缓存同步

### 核心业务验收
- **评估SLO**：P95 ≤ 10s，超时降级正确，缓存命中率>80%
- **仿真入队**：P95 ≤ 1s，任务状态可追踪，重试机制有效
- **Pre-flight诊断**：P95 ≤ 800ms，结构化输出完整，validate-only正确
- **批量操作**：成功率≥99%，审计快照完整，回滚机制有效
- **浏览器执行**：错误率≤1%，资源管理正确，代理池稳定

### 计费与安全验收
- **原子扣费**：reserve/commit/release机制正确，扣费与任务结果一致
- **计费明细**：动作/对象/任务/事件链路完整可追溯
- **OAuth/密钥治理**：密钥仅Secret Manager，刷新令牌加密，回调域白名单
- **数据隔离**：user_id强隔离，服务端状态判定，审计可追溯

### 可观测性验收
- **结构化日志**：JSON格式，包含必要字段，异常含code和堆栈
- **分布式追踪**：OpenTelemetry正确配置，链路完整
- **健康检查**：每服务/healthz正常，Gateway聚合正确
- **SLO监控**：关键指标达标，告警配置正确，趋势分析可用

### 环境与部署验收
- **环境隔离**：STACK环境正确隔离，资源命名规范
- **Secret管理**：按环境隔离，密钥轮换流程正确
- **性能优化**：Browser-Exec独立扩缩容，缓存策略有效
- **成本控制**：资源使用合理，扩缩容策略正确

## 验收标准与质量门槛

### 企业级质量标准
- **契约测试**：OpenAPI契约全部通过，被保护路由401/403正确
- **评估SLO**：P95 ≤ 10s（快扫模式），失败有可视化降级提示
- **仿真处理**：任务202入队，状态可追踪且可重试，代理池失败率可观测
- **Pre-flight**：对"无曝光无点击"能给可行动因与建议，批量变更支持干跑与审计快照
- **原子计费**：所有消耗型动作均可追溯（明细/对象/动作），扣费与任务结果一致
- **安全合规**：令牌加密、密钥只在Secret、审计日志留痕、最小权限

### 关键SLO指标

#### 性能指标
- **评估响应**：< 10s (P95)，高并发下 < 15s (P99)
- **仿真入队**：< 1s (P95)，峰值负载下 < 2s (P99)
- **Pre-flight**：< 800ms (P95)
- **批量成功率**：> 95%

#### 高并发指标
- **浏览器执行服务**：
  - 单实例：CPU < 80%, 内存 < 8GB, 并发 8-12个浏览器
  - 集群处理能力：2000-10000任务/分钟
  - 任务成功率：> 98%
  - 平均响应时间：< 5s
- **弹性扩缩容**：
  - 扩容响应时间：< 60s
  - 缩容延迟：5分钟空闲后触发
  - 最小实例：2个（预热）
  - 最大实例：50个

#### 可用性指标
- **服务可用性**：> 99.9%
- **任务重试成功率**：> 90%
- **故障恢复时间**：< 5分钟
- **Ads API**：错误码分布监控，配额使用 < 80%

### 风险缓解验证

#### 高并发风险缓解
- **浏览器资源管理**：
  - 实例池管理 + 上下文隔离 + 定期回收 + 内存监控
  - 任务超时保护 + 故障转移 + 降级处理
  - 预热策略 + 弹性扩缩容 + 负载均衡
- **任务调度风险**：
  - 优先级队列 + 批量处理 + 智能分配
  - 重试机制 + 死信队列 + 补偿处理
  - 容量监控 + 自动扩容 + 过载保护

#### 传统风险缓解
- **Playwright冷启动**：独立服务 + 预热 + 最小实例 + 超时保护
- **Ads配额管理**：validate-only + 队列限流 + 重试退避 + 回滚快照
- **10秒评估**：分阶段结果 + 降级策略 + 缓存优化 + 并行处理
- **幂等一致性**：Idempotency-Key + 事件去重 + reserve/commit/release + 事务消息

#### 容量规划风险
- **成本控制**：智能调度 + 资源复用 + 自动缩容 + 成本监控
- **性能保障**：SLO监控 + 性能基准 + 容量预警 + 扩容策略
- **故障处理**：健康检查 + 故障检测 + 自动恢复 + 运维工具

### 交付物标准
每个里程碑完成后应包含：
- **代码质量**：单元测试覆盖率80%+，集成测试通过，性能测试达标
- **文档完整**：OpenAPI规范、部署手册、运维指南、故障排查手册
- **监控就绪**：SLO监控、告警规则、仪表盘、链路追踪
- **安全合规**：安全扫描通过、密钥管理规范、审计日志完整
- **生产就绪**：蓝绿部署、回滚策略、容量规划、成本优化

## 最终验收确认

### 功能完整性验收
- [ ] **8个核心痛点**：全部通过用户验收测试，用户满意度>90%
- [ ] **上瘾体验闭环**：发现→评估→测试→监控→操作→优化完整流程验证
- [ ] **简化增强功能**：深度相似度算法、关键词扩展、精细化诊断、操作指导全部就绪

### 技术架构验收
- [ ] **事件驱动架构**：事件存储、投影器、Saga工作流全部正常运行
- [ ] **高并发浏览器服务**：2000-10000任务/分钟处理能力验证通过
- [ ] **原子计费系统**：reserve/commit/release机制100%准确性验证

### 生产环境验收
- [ ] **SLO达标**：评估<10s、仿真入队<1s、Pre-flight<800ms、成功率>99%
- [ ] **安全合规**：数据隔离、密钥管理、审计日志全部符合企业级标准
- [ ] **运维就绪**：监控告警、故障恢复、扩缩容策略全部验证通过

这个企业级实施计划确保系统具备生产环境的高可用性、高性能和高安全性要求，能够完全解决用户的8个核心痛点。

---

## 新增任务（阶段性交付）

- [x] OAS 初版（6个服务）
  - offer/siterank/adscenter/batchopen/billing/notifications 的 OpenAPI 3 契约初版已落地
- [x] TS 类型生成脚本 + 前端最小接入
  - 脚本 scripts/openapi/gen-ts-sdk.sh；前端引入 apps/frontend/src/sdk/{offer,siterank}
- [x] Notifications 服务 MVP
  - 独立服务 + /api/v1/notifications/recent（分页）+ /readyz + 统一错误体
- [x] 统一错误体与 /readyz（多服务）
  - adscenter/offer/batchopen/billing/siterank/console 已接入
- [x] Gateway v2 路由包含 notifications
  - deployments/gateway/gateway.v2.yaml + 渲染脚本支持 NOTIFICATIONS_URL
- [x] Siterank 事件发布（Requested/Completed）
  - siterank 服务在创建与完成分析时发布标准事件
- [x] Browser-Exec 服务骨架
  - Node.js 22 + Express：/healthz、/readyz、/api/v1/browser/{parse-url,check-availability,simulate-click,batch-execute}
- [x] Browser-Exec 指标与真实执行参数
  - /metrics 暴露（Prometheus），check/simulate/batch增加耗时与失败计数；simulate-click 支持 selector/wait/dwell/指纹/代理
- [x] Browser-Exec 上下文池（共享浏览器+Context池）
  - 无代理复用共享 browser，多 Context 并发；有代理使用临时 browser；容量护栏（BROWSER_MAX_CONTEXTS）
- [x] Browser-Exec 任务查询接口
  - 新增 GET /api/v1/browser/tasks/{id} 查询任务状态（queued/running/completed/failed）
- [x] Notifications 事件订阅（投影器）
  - 监听 SiterankRequested/SiterankCompleted/OfferCreated，写入 user_notifications（最近列表分页）
- [x] Siterank 主机级缓存（5分钟）
  - 对域名 host 级别结果缓存，减少重复 SimilarWeb 拉取
