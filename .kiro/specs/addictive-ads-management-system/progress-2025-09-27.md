# 进展纪要（2025-09-27）

本次迭代聚焦落地监控/运维与性能优化任务，完成如下工作：

- Browser-Exec 运维与监控能力补齐（对应任务 5.5 已完成）
  - 新增内部运维端点（均需 X-Service-Token）：
    - GET/PUT `/api/v1/browser/config`：在线查看/更新并发与池上限（concurrency/maxContexts/maxMemoryMb）
    - GET/POST `/api/v1/browser/maintenance`：维护模式开关（开启后新请求返回503）
    - GET `/api/v1/browser/capacity`：容量估算（基于当前池上限与启发式）
    - 既有 `/metrics`、`/api/v1/browser/stats` 保持不变
  - Browser 池支持运行时限流更新：导出 `setLimits/getLimits`，避免重启即可热更新
  - 新增基准脚本 `scripts/ops/bench-browser-exec.sh`，便于拉通单实例吞吐评估
  - 增加告警模板与脚本：
    - `deployments/monitoring/alerts/browser-exec-capacity.json`
    - `deployments/monitoring/create-alerts-browser-exec.sh`

- 性能与成本优化（H2.2 已完成）
  - 预先存在：Browser-Exec 独立镜像与扩缩容脚本、Adscenter Preflight 短缓存、Ads API 限流/退避与分片执行
  - 新确认：Adscenter OAuth/Ads 配置已内存缓存（TTL 可配），Siterank 域名+国家级缓存已上线

- Siterank 6.1/6.2 状态同步
  - 10秒评估SLO与外部API集成由 D1.* 已落地，复核后标记完成

- Ads 集成（9.1 已完成）
  - OAuth URL/Callback、AES-GCM加密与轮换、Live/Stub分离（build tag）、MCC链接状态机均已具备

未完成/后续建议：
- 8.2 端到端闭环性能测试：建议基于现有冒烟脚本补充端到端压测脚本（Offer→Siterank→Batchopen→Notifications），并在预发环境跑基线
- 8.3 容量规划与成本优化验证：结合 Cloud Monitoring 指标落地告警并固化 Tuning 手册
- 10.2 A/B 测试 MVP：按设计文档补齐接口与读模型

运维提示：
- 预发快速调参：`deployments/scripts/tune-preview.sh`（包含 browser-exec 扩缩容与关键 env 调整）
- 创建告警策略：`PROJECT_ID=<id> deployments/monitoring/create-alerts-browser-exec.sh`

新增接口与脚本（本轮）
- Adscenter A/B测试（MVP，需鉴权）
  - POST `/api/v1/adscenter/ab-tests`：创建测试（参数：accountId、offerId、seedAdGroupId、splitA、splitB、notes）
  - GET `/api/v1/adscenter/ab-tests`：列表 + 内置显著性判断（two-proportion z-test，p<0.05 推荐 A/B）
  - 读模型：`schemas/sql/014_abtest.sql`（ABTest、ABTestMetric）
  - 代码：`services/adscenter/main.go`（abTestsCreateHandler/abTestsListHandler）
- 端到端基础脚本
  - `scripts/e2e/e2e-perf.sh`：Siterank→Batchopen→Notifications 闭环冒烟与简单时延记录
