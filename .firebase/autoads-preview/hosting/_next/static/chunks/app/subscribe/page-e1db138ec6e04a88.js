(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9057],{39046:(e,s,t)=>{"use strict";t.d(s,{default:()=>_});var a=t(54568),l=t(7620),r=t(62942),i=t(89223),n=t(69826),d=t(82758),c=t(3815),o=t(90159),m=t(70993),x=t(69175),u=t(28551),h=t(58041),g=t(8039),b=t(51874);function p(e){var s,t,r;let{onPlanSelect:i,selectedPlan:n}=e,[d,c]=(0,l.useState)([]),[o,m]=(0,l.useState)(!0),[p,j]=(0,l.useState)("month");(0,l.useEffect)(()=>{f()},[]);let f=async()=>{try{let e=await g.L.getCached("/admin/plans",{active:!0},3e5,!1),s=(null==e?void 0:e.plans)||e||[];c(s)}catch(e){console.error("Failed to load plans:",e),b.oR.error("加载套餐失败，请稍后重试")}finally{m(!1)}},v=d.filter(e=>e.interval===p),N=(e,s)=>{if("year"===s){let s=e/12;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-3xl font-bold",children:["$",e]}),(0,a.jsx)("span",{className:"text-gray-500",children:"/year"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["$",s.toFixed(0),"/month billed annually"]})]})}return(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-3xl font-bold",children:["$",e]}),(0,a.jsx)("span",{className:"text-gray-500",children:"/month"})]})};return o?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[void 0,void 0,void 0].map((e,s)=>(0,a.jsx)("div",{className:"h-96 bg-gray-200 rounded-lg"},s))})]})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Choose the perfect plan for you"}),(0,a.jsx)("div",{className:"flex items-center justify-center mb-6",children:(0,a.jsxs)("div",{className:"bg-gray-100 p-1 rounded-lg",children:[(0,a.jsx)("button",{onClick:()=>j("month"),className:"px-4 py-2 text-sm font-medium rounded-md transition-colors ".concat("month"===p?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-900"),children:"Monthly"}),(0,a.jsxs)("button",{onClick:()=>j("year"),className:"px-4 py-2 text-sm font-medium rounded-md transition-colors relative ".concat("year"===p?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-900"),children:["Yearly",d.length>0&&(0,a.jsxs)("span",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:["Save ",Math.round(((r=(null==(s=d.find(e=>"month"===e.interval))?void 0:s.price)||0)-((null==(t=d.find(e=>"year"===e.interval))?void 0:t.price)||0)/12)/r*100),"%"]})]})]})})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto",children:v.map(e=>{var s;return(0,a.jsxs)("div",{className:"relative rounded-lg border-2 p-6 cursor-pointer transition-all ".concat(e.popular||(null==n?void 0:n.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>i(e),children:[e.popular&&(0,a.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-500 text-white",children:[(0,a.jsx)(x.A,{className:"w-3 h-3 mr-1"}),"Most Popular"]})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:e.name}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:e.description}),(0,a.jsx)("div",{className:"mb-6",children:N(e.price,e.interval)}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:e.tokens.toLocaleString()}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["tokens per ",e.interval]})]}),(0,a.jsx)("ul",{className:"space-y-3 mb-8",children:null==(s=e.features)?void 0:s.map((e,s)=>(0,a.jsxs)("li",{className:"flex items-start",children:[(0,a.jsx)(u.A,{className:"h-5 w-5 text-green-500 mr-3 mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:e})]},s))}),(0,a.jsxs)("button",{onClick:()=>i(e),className:"w-full flex items-center justify-center px-4 py-3 border border-transparent text-sm font-medium rounded-md transition-colors ".concat(e.popular||(null==n?void 0:n.id)===e.id?"text-white bg-blue-600 hover:bg-blue-700":"text-blue-600 bg-white border-blue-600 hover:bg-blue-50"),children:[(null==n?void 0:n.id)===e.id?"Selected":"Select Plan",(0,a.jsx)(h.A,{className:"w-4 h-4 ml-2"})]})]})]},e.id)})}),0===v.length&&(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsxs)("p",{className:"text-gray-500",children:["No plans available for ",p,"ly billing."]})})]})}var j=t(80035),f=t(43125),v=t(40860);function N(e){let{plan:s,onSubmit:t,loading:r}=e,[i,n]=(0,l.useState)({name:"",email:"",address:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US"}}),[d,c]=(0,l.useState)({}),[o,m]=(0,l.useState)(null),[x,u]=(0,l.useState)(""),[h,g]=(0,l.useState)(""),[b,p]=(0,l.useState)(""),N=()=>{let e={};return i.name.trim()||(e.name="Name is required"),i.email.trim()?/\S+@\S+\.\S+/.test(i.email)||(e.email="Email is invalid"):e.email="Email is required",i.address.line1.trim()||(e.address_line1="Address is required"),i.address.city.trim()||(e.city="City is required"),i.address.state.trim()||(e.state="State is required"),i.address.postal_code.trim()||(e.postal_code="Postal code is required"),c(e),0===Object.keys(e).length},y=async e=>{if(e.preventDefault(),r||!N())return;if(!x.trim()||!h.trim()||!b.trim())return void m("Please fill in all card fields");let s="pm_mock_"+Math.random().toString(36).slice(2,10);await t({paymentMethodId:s,billingDetails:i})},w=(e,s)=>{if(e.startsWith("address.")){let t=e.split(".")[1];n(e=>({...e,address:{...e.address,[t]:s}}))}else n(t=>({...t,[e]:s}));d[e]&&c(s=>({...s,[e]:""}))},S="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 border-gray-300";return(0,a.jsxs)("form",{onSubmit:y,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Order Summary"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:s.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[s.tokens.toLocaleString()," tokens per ",s.interval]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"font-bold text-lg",children:["$",s.price]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["per ",s.interval]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Billing Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),(0,a.jsx)("input",{type:"text",id:"name",value:i.name,onChange:e=>w("name",e.target.value),className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(d.name?"border-red-300":"border-gray-300"),placeholder:"John Doe"}),d.name&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),(0,a.jsx)("input",{type:"email",id:"email",value:i.email,onChange:e=>w("email",e.target.value),className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(d.email?"border-red-300":"border-gray-300"),placeholder:"john@example.com"}),d.email&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.email})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{htmlFor:"address_line1",className:"block text-sm font-medium text-gray-700 mb-1",children:"Address *"}),(0,a.jsx)("input",{type:"text",id:"address_line1",value:i.address.line1,onChange:e=>w("address.line1",e.target.value),className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(d.address_line1?"border-red-300":"border-gray-300"),placeholder:"123 Main Street"}),d.address_line1&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.address_line1})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{htmlFor:"address_line2",className:"block text-sm font-medium text-gray-700 mb-1",children:"Address Line 2 (Optional)"}),(0,a.jsx)("input",{type:"text",id:"address_line2",value:i.address.line2||"",onChange:e=>w("address.line2",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Apartment, suite, etc."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-1",children:"City *"}),(0,a.jsx)("input",{type:"text",id:"city",value:i.address.city,onChange:e=>w("address.city",e.target.value),className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(d.city?"border-red-300":"border-gray-300"),placeholder:"New York"}),d.city&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.city})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"state",className:"block text-sm font-medium text-gray-700 mb-1",children:"State *"}),(0,a.jsx)("input",{type:"text",id:"state",value:i.address.state,onChange:e=>w("address.state",e.target.value),className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(d.state?"border-red-300":"border-gray-300"),placeholder:"NY"}),d.state&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.state})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"postal_code",className:"block text-sm font-medium text-gray-700 mb-1",children:"Postal Code *"}),(0,a.jsx)("input",{type:"text",id:"postal_code",value:i.address.postal_code,onChange:e=>w("address.postal_code",e.target.value),className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(d.postal_code?"border-red-300":"border-gray-300"),placeholder:"10001"}),d.postal_code&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.postal_code})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Payment Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Number"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",autoComplete:"cc-number",placeholder:"4242 4242 4242 4242",className:S,value:x,onChange:e=>u(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",autoComplete:"cc-exp",placeholder:"MM/YY",className:S,value:h,onChange:e=>g(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CVC"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",autoComplete:"cc-csc",placeholder:"CVC",className:S,value:b,onChange:e=>p(e.target.value)})]})]}),o&&(0,a.jsxs)("div",{className:"mt-2 flex items-center text-sm text-red-600",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-1"}),o]})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(f.A,{className:"h-5 w-5 text-blue-400 mr-3 mt-0.5"}),(0,a.jsxs)("div",{className:"text-sm text-blue-700",children:[(0,a.jsx)("p",{className:"font-medium",children:"Secure Payment"}),(0,a.jsx)("p",{children:"预发环境不进行真实扣款；生产环境将通过合规支付渠道加密处理，我们不会存储您的卡片信息。"})]})]})}),(0,a.jsx)("button",{type:"submit",disabled:r,className:"w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.A,{className:"h-5 w-5 mr-2"}),"Subscribe for $",s.price,"/",s.interval]})})]})}function y(e){return(0,a.jsx)(N,{...e})}var w=t(52510),S=t(12509),k=t(85062),C=t(20018);function A(e){var s;let{plan:t,subscriptionId:i}=e,n=(0,r.useRouter)(),[d,c]=(0,l.useState)(null),[m,x]=(0,l.useState)(!0);(0,l.useEffect)(()=>{u()},[i]);let u=async()=>{try{let e=await g.L.get("/subscriptions/".concat(i));c(e)}catch(e){console.error("Failed to load subscription details:",e),b.oR.error("加载订阅详情失败，请稍后重试")}finally{x(!1)}};return m?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3 mx-auto"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3 mx-auto"}),(0,a.jsx)("div",{className:"h-32 bg-gray-200 rounded"})]})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4",children:(0,a.jsx)(w.A,{className:"h-8 w-8 text-green-600"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Subscription Successful!"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Welcome to ",t.name,"! Your subscription is now active and ready to use."]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Subscription Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(S.A,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Plan"}),(0,a.jsx)("div",{className:"font-medium",children:t.name})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(k.A,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Billing"}),(0,a.jsxs)("div",{className:"font-medium",children:["$",t.price," per ",t.interval]})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-5 w-5 bg-blue-500 rounded-full mr-3 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-xs font-bold",children:"T"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Tokens"}),(0,a.jsxs)("div",{className:"font-medium",children:[t.tokens.toLocaleString()," per ",t.interval]})]})]})]}),d&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-5 w-5 bg-green-500 rounded-full mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Status"}),(0,a.jsx)("div",{className:"font-medium capitalize",children:d.status})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(k.A,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Next Billing Date"}),(0,a.jsx)("div",{className:"font-medium",children:new Date(d.nextBillingDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]}),d.paymentMethod&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.A,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Payment Method"}),(0,a.jsxs)("div",{className:"font-medium",children:[d.paymentMethod.brand.toUpperCase()," ****",d.paymentMethod.last4]})]})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"What's Included"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:null==(s=t.features)?void 0:s.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(w.A,{className:"h-5 w-5 text-green-500 mr-3 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:e})]},s))})]}),(null==d?void 0:d.invoice)&&(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(C.A,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:["Invoice #",d.invoice.id]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Amount: $",d.invoice.amount]})]})]}),(0,a.jsx)("button",{onClick:()=>{var e;(null==d||null==(e=d.invoice)?void 0:e.url)&&window.open(d.invoice.url,"_blank")},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Download"})]})}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,a.jsxs)("button",{onClick:()=>{n.push("/dashboard")},className:"flex-1 flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:["Go to Dashboard",(0,a.jsx)(h.A,{className:"ml-2 h-5 w-5"})]}),(0,a.jsx)("button",{onClick:()=>{n.push("/account/subscription")},className:"flex-1 flex items-center justify-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Manage Subscription"})]}),(0,a.jsxs)("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"What's Next?"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,a.jsx)("li",{children:"• Your tokens have been added to your account"}),(0,a.jsx)("li",{children:"• You can now access all premium features"}),(0,a.jsx)("li",{children:"• Check your email for a confirmation receipt"}),(0,a.jsx)("li",{children:"• Visit your dashboard to start using the service"})]})]})]})}function _(){let e=(0,r.useRouter)(),s=(0,r.useSearchParams)(),{data:t,status:x}=(0,i.useSession)(),[u,h]=(0,l.useState)("plan-selection"),[j,f]=(0,l.useState)(null),[v,N]=(0,l.useState)(!1),[w,S]=(0,l.useState)(null),[k,C]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=(null==s?void 0:s.get("plan"))||void 0;e&&_(e)},[s]),(0,l.useEffect)(()=>{"unauthenticated"===x&&e.push("/auth/signin?callbackUrl=/subscribe")},[x,e]);let _=async e=>{try{let s=await g.L.get("/admin/plans/".concat(e));f(s)}catch(e){console.error("Failed to load plan details:",e)}},P=async e=>{if(j&&(null==t?void 0:t.user)){N(!0),S(null);try{let s=await g.L.post("/subscriptions",{planId:j.id,stripePriceId:j.stripePriceId,paymentMethodId:e.paymentMethodId,billingDetails:e.billingDetails});if(null==s?void 0:s.subscriptionId)C(s.subscriptionId),h("success");else throw Error((null==s?void 0:s.error)||"Subscription creation failed")}catch(s){console.error("Subscription error:",s);let e=s instanceof Error?s.message:"An error occurred";S(e),b.oR.error("创建订阅失败："+e),h("error")}finally{N(!1)}}},M=()=>{h("plan-selection"),f(null),S(null)};return((0,l.useEffect)(()=>{},[!1,u,j]),"loading"===x)?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-8",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"}),(0,a.jsx)("div",{className:"h-32 bg-gray-200 rounded"})]})}):"unauthenticated"===x?null:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsx)("nav",{"aria-label":"Progress",children:(0,a.jsxs)("ol",{className:"flex items-center",children:[(0,a.jsx)("li",{className:"relative",children:(0,a.jsxs)("div",{className:"flex items-center ".concat("plan-selection"===u?"text-blue-600":["payment","confirmation","success"].includes(u)?"text-green-600":"text-gray-500"),children:[(0,a.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full border-2 ".concat("plan-selection"===u?"border-blue-600 bg-blue-50":["payment","confirmation","success"].includes(u)?"border-green-600 bg-green-50":"border-gray-300"),children:["payment","confirmation","success"].includes(u)?(0,a.jsx)(n.A,{className:"w-5 h-5"}):(0,a.jsx)("span",{className:"text-sm font-medium",children:"1"})}),(0,a.jsx)("span",{className:"ml-2 text-sm font-medium",children:"Select Plan"})]})}),(0,a.jsx)("li",{className:"relative ml-8",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:(0,a.jsx)("div",{className:"h-0.5 w-full ".concat(["payment","confirmation","success"].includes(u)?"bg-green-600":"bg-gray-200")})}),(0,a.jsx)("div",{className:"relative flex items-center justify-center w-8 h-8 rounded-full border-2 bg-white ".concat("payment"===u?"border-blue-600 bg-blue-50 text-blue-600":["confirmation","success"].includes(u)?"border-green-600 bg-green-50 text-green-600":"border-gray-300 text-gray-500"),children:["confirmation","success"].includes(u)?(0,a.jsx)(n.A,{className:"w-5 h-5"}):(0,a.jsx)("span",{className:"text-sm font-medium",children:"2"})}),(0,a.jsx)("span",{className:"ml-2 text-sm font-medium ".concat("payment"===u?"text-blue-600":["confirmation","success"].includes(u)?"text-green-600":"text-gray-500"),children:"Payment"})]})}),(0,a.jsx)("li",{className:"relative ml-8",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:(0,a.jsx)("div",{className:"h-0.5 w-full ".concat("success"===u?"bg-green-600":"bg-gray-200")})}),(0,a.jsx)("div",{className:"relative flex items-center justify-center w-8 h-8 rounded-full border-2 bg-white ".concat("success"===u?"border-green-600 bg-green-50 text-green-600":"border-gray-300 text-gray-500"),children:"success"===u?(0,a.jsx)(n.A,{className:"w-5 h-5"}):(0,a.jsx)("span",{className:"text-sm font-medium",children:"3"})}),(0,a.jsx)("span",{className:"ml-2 text-sm font-medium ".concat("success"===u?"text-green-600":"text-gray-500"),children:"Complete"})]})})]})})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow",children:["plan-selection"===u&&(0,a.jsx)(p,{onPlanSelect:e=>{f(e),h("payment")},selectedPlan:j}),"payment"===u&&j&&(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("button",{onClick:M,className:"flex items-center text-gray-600 hover:text-gray-900",children:[(0,a.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"Back to plan selection"]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Selected Plan"}),(0,a.jsx)("div",{className:"font-semibold",children:j.name}),(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:["$",j.price,"/",j.interval]})]})]}),(0,a.jsx)(y,{plan:j,onSubmit:P,loading:v})]}),"success"===u&&j&&k&&(0,a.jsx)(A,{plan:j,subscriptionId:k}),"error"===u&&(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(c.A,{className:"mx-auto h-12 w-12 text-red-400"}),(0,a.jsx)("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Payment Failed"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:w||"There was an error processing your payment. Please try again."}),(0,a.jsxs)("div",{className:"mt-6 flex justify-center space-x-4",children:[(0,a.jsxs)("button",{onClick:()=>{h("payment"),S(null)},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,a.jsx)(o.A,{className:"w-4 h-4 mr-2"}),"Try Again"]}),(0,a.jsx)("button",{onClick:M,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Change Plan"})]})]})})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(m.A,{className:"h-5 w-5 text-blue-400"}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"Secure Payment"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-blue-700",children:(0,a.jsx)("p",{children:"预发环境不会发起真实扣款；在生产环境，支付将通过合规渠道加密处理，我们不会在服务器上存储您的卡片信息。"})})]})]})})]})}},52083:(e,s,t)=>{Promise.resolve().then(t.bind(t,39046))}},e=>{var s=s=>e(e.s=s);e.O(0,[2076,4121,7358],()=>s(52083)),_N_E=e.O()}]);