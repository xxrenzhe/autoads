(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9805],{63709:(e,s,a)=>{Promise.resolve().then(a.bind(a,90451))},90451:(e,s,a)=>{"use strict";a.d(s,{default:()=>h});var l=a(54568),t=a(7620),c=a(63353),i=a(64148),n=a(47227),r=a(3761),d=a(70111),x=a(8039),m=a(51874);function h(){var e;let[s,a]=(0,t.useState)(null),[h,o]=(0,t.useState)(null),[j,u]=(0,t.useState)([]),[f,p]=(0,t.useState)(null),[N,v]=(0,t.useState)(!0),[g,b]=(0,t.useState)(null);(0,t.useEffect)(()=>{y();let e=setInterval(y,3e4);return()=>clearInterval(e)},[]);let y=async()=>{try{v(!0);let e=await x.L.getCached("/monitoring/metrics",void 0,1e4,!1);e.success&&(a(e.data.aggregated),o(e.data.health));let s=await x.L.getCached("/monitoring/alerts",void 0,1e4,!1);s.success&&(u(s.data.alerts),p(s.data.stats))}catch(e){b("Failed to fetch monitoring data"),console.error("Error fetching monitoring data:",e),m.oR.error("加载监控数据失败，请稍后重试")}finally{v(!1)}},w=async e=>{try{let s=await x.L.post("/monitoring/alerts",{action:"acknowledge",data:{alertId:e,acknowledgedBy:"dashboard-user"}});(null==s?void 0:s.success)!==!1&&u(s=>{var a;return null==s||null==(a=s.filter(Boolean))?void 0:a.map(s=>s.id===e?{...s,acknowledged:!0}:s)})}catch(e){console.error("Error acknowledging alert:",e)}},R=e=>"".concat((100*e).toFixed(1),"%"),Z=e=>e<1e3?"".concat(e,"ms"):e<6e4?"".concat((e/1e3).toFixed(1),"s"):"".concat((e/6e4).toFixed(1),"m");return N?(0,l.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-lg",children:"加载监控数据..."})]})}):g?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,l.jsx)("div",{className:"max-w-md w-full",children:(0,l.jsxs)("div",{className:"bg-red-50 border-2 border-red-200 rounded-2xl p-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,l.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-red-600 font-bold text-xl",children:"!"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-red-900",children:"加载错误"}),(0,l.jsx)("p",{className:"text-red-800",children:g})]})]}),(0,l.jsx)(n.$,{onClick:y,className:"w-full bg-red-600 hover:bg-red-700 text-white",children:"重试"})]})})}):(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 p-4 lg:p-8",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto space-y-8",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"系统监控仪表板"}),(0,l.jsx)("p",{className:"text-gray-600",children:"实时监控系统性能、健康状态和服务可用性"})]}),(0,l.jsx)(n.$,{onClick:y,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 flex items-center gap-2 shadow-lg hover:shadow-xl transform hover:scale-105",disabled:N,children:N?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-lg animate-spin",children:"⏳"}),"刷新中..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-lg",children:"\uD83D\uDD04"}),"刷新数据"]})})]}),h&&(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,l.jsxs)(c.Zp,{children:[(0,l.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(c.ZB,{className:"text-sm font-medium",children:"API 健康度"}),(0,l.jsx)(i.E,{variant:h.api.successRate>.95?"default":"destructive",children:R(h.api.successRate)})]}),(0,l.jsxs)(c.Wu,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:Z(h.api.avgResponseTime)}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"平均响应时间"})]})]}),(0,l.jsxs)(c.Zp,{children:[(0,l.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(c.ZB,{className:"text-sm font-medium",children:"数据库健康度"}),(0,l.jsx)(i.E,{variant:h.database.successRate>.98?"default":"destructive",children:R(h.database.successRate)})]}),(0,l.jsxs)(c.Wu,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:Z(h.database.avgQueryTime)}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"平均查询时间"})]})]}),(0,l.jsxs)(c.Zp,{children:[(0,l.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(c.ZB,{className:"text-sm font-medium",children:"外部服务健康度"}),(0,l.jsx)(i.E,{variant:h.external.successRate>.9?"default":"destructive",children:R(h.external.successRate)})]}),(0,l.jsxs)(c.Wu,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:Z(h.external.avgResponseTime)}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"平均响应时间"})]})]}),(0,l.jsxs)(c.Zp,{children:[(0,l.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(c.ZB,{className:"text-sm font-medium",children:"业务操作健康度"}),(0,l.jsx)(i.E,{variant:h.business.successRate>.95?"default":"destructive",children:R(h.business.successRate)})]}),(0,l.jsxs)(c.Wu,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:Z(h.business.avgOperationTime)}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"平均操作时间"})]})]})]}),(0,l.jsxs)(r.tU,{defaultValue:"metrics",className:"space-y-4",children:[(0,l.jsxs)(r.j7,{children:[(0,l.jsx)(r.Xi,{value:"metrics",children:"性能指标"}),(0,l.jsx)(r.Xi,{value:"alerts",children:"告警"})]}),(0,l.jsx)(r.av,{value:"metrics",className:"space-y-4",children:s&&(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,l.jsxs)(c.Zp,{children:[(0,l.jsx)(c.aR,{children:(0,l.jsx)(c.ZB,{children:"请求统计"})}),(0,l.jsxs)(c.Wu,{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"总请求数"}),(0,l.jsx)("span",{className:"font-medium",children:s.count})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"成功率"}),(0,l.jsx)("span",{className:"font-medium text-green-600",children:R(s.successRate)})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"错误率"}),(0,l.jsx)("span",{className:"font-medium text-red-600",children:R(s.errorRate)})]})]})]}),(0,l.jsxs)(c.Zp,{children:[(0,l.jsx)(c.aR,{children:(0,l.jsx)(c.ZB,{children:"响应时间"})}),(0,l.jsxs)(c.Wu,{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"平均"}),(0,l.jsx)("span",{className:"font-medium",children:Z(s.avgDuration)})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"最小"}),(0,l.jsx)("span",{className:"font-medium",children:Z(s.minDuration)})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"最大"}),(0,l.jsx)("span",{className:"font-medium",children:Z(s.maxDuration)})]})]})]}),(0,l.jsxs)(c.Zp,{children:[(0,l.jsx)(c.aR,{children:(0,l.jsx)(c.ZB,{children:"百分位响应时间"})}),(0,l.jsxs)(c.Wu,{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"P95"}),(0,l.jsx)("span",{className:"font-medium",children:Z(s.p95Duration)})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"P99"}),(0,l.jsx)("span",{className:"font-medium",children:Z(s.p99Duration)})]})]})]})]})}),(0,l.jsxs)(r.av,{value:"alerts",className:"space-y-4",children:[f&&(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,l.jsxs)(c.Zp,{children:[(0,l.jsx)(c.aR,{className:"pb-2",children:(0,l.jsx)(c.ZB,{className:"text-sm font-medium",children:"总告警数"})}),(0,l.jsx)(c.Wu,{children:(0,l.jsx)("div",{className:"text-2xl font-bold",children:f.totalAlerts})})]}),(0,l.jsxs)(c.Zp,{children:[(0,l.jsx)(c.aR,{className:"pb-2",children:(0,l.jsx)(c.ZB,{className:"text-sm font-medium",children:"未确认告警"})}),(0,l.jsx)(c.Wu,{children:(0,l.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:f.unacknowledgedAlerts})})]}),(0,l.jsxs)(c.Zp,{children:[(0,l.jsx)(c.aR,{className:"pb-2",children:(0,l.jsx)(c.ZB,{className:"text-sm font-medium",children:"严重告警"})}),(0,l.jsx)(c.Wu,{children:(0,l.jsx)("div",{className:"text-2xl font-bold text-red-600",children:(null==(e=f.alertsBySeverity)?void 0:e.critical)||0})})]}),(0,l.jsxs)(c.Zp,{children:[(0,l.jsx)(c.aR,{className:"pb-2",children:(0,l.jsx)(c.ZB,{className:"text-sm font-medium",children:"最近告警"})}),(0,l.jsx)(c.Wu,{children:(0,l.jsx)("div",{className:"text-2xl font-bold",children:f.recentAlerts})})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"最近告警"}),0===j.length?(0,l.jsx)(d.Fc,{children:(0,l.jsx)(d.TN,{children:"暂无告警"})}):j.map(e=>(0,l.jsx)(d.Fc,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)(d.XL,{className:"flex items-center gap-2",children:[(0,l.jsx)(i.E,{variant:"critical"===e.severity?"destructive":"default",children:e.severity}),e.ruleName]}),(0,l.jsx)(d.TN,{children:e.message}),(0,l.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.timestamp).toLocaleString()})]}),!e.acknowledged&&(0,l.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>w(e.id),children:"确认"})]})},e.id))]})]})]})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2076,4121,7358],()=>s(63709)),_N_E=e.O()}]);