(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2944],{73021:(e,s,a)=>{Promise.resolve().then(a.bind(a,78644))},78644:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>h});var i=a(54568),t=a(7620),l=a(63353),c=a(47227),n=a(65165),r=a(67474),d=a(81872),o=a(51874),x=a(589);function h(){let[e,s]=(0,t.useState)([]),[a,h]=(0,t.useState)(""),[u,m]=(0,t.useState)("mock"),[v,j]=(0,t.useState)("daily"),[f,p]=(0,t.useState)([]),[g,y]=(0,t.useState)(null),{guardAdsCenter:N}=(0,x.B)(),b=async()=>{let e=await fetch("/api/v2/adscenter/offers"),a=await e.json();s((null==a?void 0:a.items)||[])};(0,t.useEffect)(()=>{b().catch(()=>{})},[]);let _=async()=>{if(N().ok)try{if(!(await fetch("/api/v2/adscenter/offers",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({offerUrl:a,accountId:u,rotationFrequency:v})})).ok)throw Error("绑定失败");o.oR.success("绑定成功"),h(""),b()}catch(e){o.oR.error((null==e?void 0:e.message)||"绑定失败")}},k=async e=>{if(!N().ok||!e)return;let s=await fetch("/api/v2/adscenter/offers/".concat(e,"/rotate"),{method:"POST"}),a=await s.json().catch(()=>({}));s.ok&&(null==a?void 0:a.ok)?(o.oR.success("已轮换"),b()):o.oR.error((null==a?void 0:a.message)||"轮换失败")},w=async e=>{if(!e)return;let s=await fetch("/api/v2/adscenter/offers/".concat(e,"/rotations")),a=await s.json().catch(()=>({}));y(e),p((null==a?void 0:a.items)||[])};return(0,i.jsxs)("div",{className:"max-w-5xl mx-auto p-6 space-y-6",children:[(0,i.jsxs)(l.Zp,{className:"p-6",children:[(0,i.jsx)("div",{className:"text-lg font-semibold mb-3",children:"新建绑定"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(r.J,{children:"Offer URL"}),(0,i.jsx)(n.p,{value:a,onChange:e=>h(e.target.value),placeholder:"https://..."})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(r.J,{children:"账户"}),(0,i.jsx)(n.p,{value:u,onChange:e=>m(e.target.value),placeholder:"mock 或 customerId"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(r.J,{children:"频率"}),(0,i.jsxs)(d.l6,{value:v,onValueChange:j,children:[(0,i.jsx)(d.bq,{children:(0,i.jsx)(d.yv,{})}),(0,i.jsxs)(d.gC,{children:[(0,i.jsx)(d.eb,{value:"hourly",children:"hourly"}),(0,i.jsx)(d.eb,{value:"daily",children:"daily"}),(0,i.jsx)(d.eb,{value:"weekly",children:"weekly"})]})]})]})]}),(0,i.jsx)("div",{className:"mt-4",children:(0,i.jsx)(c.$,{onClick:_,children:"绑定"})})]}),(0,i.jsxs)(l.Zp,{className:"p-6",children:[(0,i.jsx)("div",{className:"text-lg font-semibold mb-3",children:"绑定列表"}),(0,i.jsx)("div",{className:"space-y-3",children:e.map((e,s)=>(0,i.jsxs)("div",{className:"border rounded p-3",children:[(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:["Offer: ",e.offer_url]}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["绑定ID: ",e.binding_id||"-"]}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["账户: ",e.account_id||"-",", 频率: ",e.rotation_frequency||"-"]}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["上次: ",e.last_rotation_at||"-","，下次: ",e.next_rotation_at||"-"]}),(0,i.jsxs)("div",{className:"mt-2 space-x-2",children:[e.binding_id&&(0,i.jsx)(c.$,{variant:"outline",onClick:()=>k(e.binding_id),children:"手动轮换"}),e.binding_id&&(0,i.jsx)(c.$,{variant:"outline",onClick:()=>w(e.binding_id),children:"查看历史"})]})]},"".concat(e.offer_id,"-").concat(e.binding_id,"-").concat(s)))})]}),g&&(0,i.jsxs)(l.Zp,{className:"p-6",children:[(0,i.jsxs)("div",{className:"text-lg font-semibold mb-3",children:["轮换历史（绑定 ",g,"）"]}),(0,i.jsx)("div",{className:"space-y-2 text-sm",children:0===f.length?(0,i.jsx)("div",{className:"text-gray-500",children:"暂无历史"}):f.map((e,s)=>(0,i.jsxs)("div",{className:"border rounded p-2",children:[(0,i.jsxs)("div",{children:["时间：",e.rotatedAt||e.rotated_at]}),(0,i.jsxs)("div",{children:["状态：",e.status]}),(0,i.jsxs)("div",{className:"text-gray-600 break-all",children:[e.finalUrl,e.finalUrlSuffix?"?"+e.finalUrlSuffix:""]})]},s))})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2076,4121,7358],()=>s(73021)),_N_E=e.O()}]);