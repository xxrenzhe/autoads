(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3420],{87672:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var r=t(54568),a=t(7620),l=t(41196),i=t(58482);function c(){var e,s,t,c;let{data:d,loading:o,error:u,refresh:h}=function(){let{refreshMs:e=5e3}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[s,t]=(0,a.useState)(null),[r,l]=(0,a.useState)(!0),[i,c]=(0,a.useState)(null),n=(0,a.useRef)(null);async function d(){try{let e=await fetch("/ops/api/v1/console/autoclick/queue/state",{headers:{Accept:"application/json"}});if(!e.ok)throw Error("HTTP ".concat(e.status));let s=await e.json(),r=(null==s?void 0:s.data)||s;t({httpQueue:Number((null==r?void 0:r.httpQueue)||0),httpWorkers:Number((null==r?void 0:r.httpWorkers)||0),browserQueue:Number((null==r?void 0:r.browserQueue)||0),browserWorkers:Number((null==r?void 0:r.browserWorkers)||0)}),c(null)}catch(e){c((null==e?void 0:e.message)||"加载失败")}finally{l(!1)}}return(0,a.useEffect)(()=>(d(),n.current&&clearInterval(n.current),n.current=setInterval(d,e),()=>{n.current&&clearInterval(n.current)}),[e]),{data:s,loading:r,error:i,refresh:d}}({refreshMs:5e3}),m=(0,a.useRef)([]);if(d){let e=Date.now();m.current.push({ts:e,http:d.httpQueue,br:d.browserQueue}),m.current.length>60&&m.current.shift()}let x=(0,a.useMemo)(()=>{if(!d)return 0;let e=Math.max(1,d.httpWorkers);return Math.round(d.httpQueue/(3*e)*100)},[d]),p=(0,a.useMemo)(()=>{if(!d)return 0;let e=Math.max(1,d.browserWorkers);return Math.round(d.browserQueue/(2*e)*100)},[d]);return(0,r.jsx)(l.OZ,{title:"AutoClick 队列面板",description:"实时查看长期池队列与并发状况",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"每 5 秒自动刷新"}),(0,r.jsx)("button",{className:i.B8.buttons.outline,onClick:h,children:"手动刷新"})]}),o?(0,r.jsx)("div",{className:"".concat(i.B8.cards.simple," p-6 text-gray-600"),children:"加载中..."}):u?(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-6 text-red-600"),children:["加载失败：",u]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-4"),children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"HTTP 队列"}),(0,r.jsx)("div",{className:"text-2xl font-semibold",children:null!=(e=null==d?void 0:d.httpQueue)?e:0})]}),(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-4"),children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"HTTP Workers"}),(0,r.jsx)("div",{className:"text-2xl font-semibold",children:null!=(s=null==d?void 0:d.httpWorkers)?s:0})]}),(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-4"),children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Browser 队列"}),(0,r.jsx)("div",{className:"text-2xl font-semibold",children:null!=(t=null==d?void 0:d.browserQueue)?t:0})]}),(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-4"),children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Browser Workers"}),(0,r.jsx)("div",{className:"text-2xl font-semibold",children:null!=(c=null==d?void 0:d.browserWorkers)?c:0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-4"),children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"HTTP 吞吐（件/秒）"}),(0,r.jsx)("div",{className:"text-2xl font-semibold",children:"number"==typeof(null==d?void 0:d.httpThroughput)?d.httpThroughput.toFixed(2):"-"})]}),(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-4"),children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"HTTP 平均等待（ms）"}),(0,r.jsx)("div",{className:"text-2xl font-semibold",children:"number"==typeof(null==d?void 0:d.httpAvgWaitMs)?Math.round(d.httpAvgWaitMs):"-"})]}),(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-4"),children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Browser 吞吐（件/秒）"}),(0,r.jsx)("div",{className:"text-2xl font-semibold",children:"number"==typeof(null==d?void 0:d.browserThroughput)?d.browserThroughput.toFixed(2):"-"})]}),(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-4"),children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Browser 平均等待（ms）"}),(0,r.jsx)("div",{className:"text-2xl font-semibold",children:"number"==typeof(null==d?void 0:d.browserAvgWaitMs)?Math.round(d.browserAvgWaitMs):"-"})]})]}),(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-4"),children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900 mb-2",children:"近 5 分钟队列趋势（HTTP / Browser）"}),(0,r.jsx)("div",{className:"h-24 relative",children:(0,r.jsx)(n,{points:m.current.map(e=>({http:e.http,br:e.br}))})})]}),(x>100||p>100)&&(0,r.jsxs)("div",{className:"".concat(i.B8.cards.simple," p-4 border-red-300 bg-red-50"),children:[(0,r.jsx)("div",{className:"text-sm font-medium text-red-700",children:"队列积压预警"}),(0,r.jsxs)("div",{className:"text-sm text-red-600 mt-1",children:[x>100&&(0,r.jsxs)("span",{className:"mr-4",children:["HTTP 队列压力 ",x,"%（建议调高 AutoClick_HTTP_Concurrency 或降低推进速率）"]}),p>100&&(0,r.jsxs)("span",{children:["Browser 队列压力 ",p,"%（建议调高 AutoClick_Browser_Concurrency 或优先 HTTP）"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("a",{href:"/admin/system/autoclick",className:i.B8.buttons.outline,children:"调整并发配置"}),(0,r.jsx)("a",{href:"/admin/autoclick/problem-urls",className:i.B8.buttons.outline,children:"查看问题 URL"})]})]})]})})}function n(e){let{points:s}=e,t=Math.max(1,...s.map(e=>Math.max(e.http,e.br))),a=s.length>1?552/(s.length-1):560;return(0,r.jsxs)("div",{className:"w-full h-24 relative",children:[s.map((e,l)=>{if(0===l)return null;let i=4+(l-1)*a,c=4+l*a,n=4+88*(1-s[l-1].http/t),d=4+88*(1-e.http/t);return(0,r.jsx)("div",{style:{position:"absolute",left:Math.min(i,c),top:Math.min(n,d),width:Math.max(2,Math.abs(c-i)),height:Math.max(2,Math.abs(d-n)),background:"linear-gradient(90deg, rgba(59,130,246,0.8), rgba(37,99,235,0.8))",opacity:.8}},"h-".concat(l))}),s.map((e,l)=>{if(0===l)return null;let i=4+(l-1)*a,c=4+l*a,n=4+88*(1-s[l-1].br/t),d=4+88*(1-e.br/t);return(0,r.jsx)("div",{style:{position:"absolute",left:Math.min(i,c),top:Math.min(n,d),width:Math.max(2,Math.abs(c-i)),height:Math.max(2,Math.abs(d-n)),background:"linear-gradient(90deg, rgba(168,85,247,0.8), rgba(147,51,234,0.8))",opacity:.7}},"b-".concat(l))})]})}},93277:(e,s,t)=>{Promise.resolve().then(t.bind(t,87672))}},e=>{var s=s=>e(e.s=s);e.O(0,[2076,4121,7358],()=>s(93277)),_N_E=e.O()}]);