(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7236],{12428:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(54568),r=a(7620),c=a(41196),l=a(58482);function o(){let[e,t]=(0,r.useState)("0.3"),[a,o]=(0,r.useState)([{code:"US",value:""},{code:"UK",value:""},{code:"CN",value:""},{code:"JP",value:""}]),[i,n]=(0,r.useState)(!1),[u,p]=(0,r.useState)(!0),[d,x]=(0,r.useState)(""),[h,m]=(0,r.useState)("10"),[y,v]=(0,r.useState)("3"),[k,_]=(0,r.useState)("3"),[g,C]=(0,r.useState)(""),[b,j]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/ops/api/v1/console/system/config"),s=await e.json(),r=(null==s?void 0:s.data)||[],c=e=>{var t;return(null==(t=r.find(t=>t.config_key===e))?void 0:t.config_value)||""},l=c("AutoClick_Count_Variance_Hour")||"0.3";t(l);let i="Proxy_URL_",n=r.filter(e=>String(e.config_key||"").startsWith(i)).map(e=>({code:String(e.config_key).slice(i.length),value:e.config_value||""})),u=[...a];n.forEach(e=>{let t=u.findIndex(t=>t.code.toUpperCase()===String(e.code).toUpperCase());t>=0?u[t].value=e.value:u.push({code:e.code.toUpperCase(),value:e.value})}),o(u),m(c("AutoClick_HTTP_Concurrency")||"10"),v(c("AutoClick_Browser_Concurrency")||"3"),_(c("AutoClick_MaxStepPerTick")||"3"),C(c("AutoClick_User_RPM")||""),j(c("AutoClick_Browser_Executor_URL")||"")}catch(e){}p(!1)})()},[]);let N=async()=>{n(!0),x("");try{let t=[];t.push({op:"set",key:"AutoClick_Count_Variance_Hour",value:e||"0.3",category:"autoclick",description:"variance"});let s=[];if(a.forEach(e=>{let a=(e.code||"").toUpperCase().replace(/[^A-Z]/g,"");if(!a)return;let r="Proxy_URL_".concat(a);s.push(r),e.value&&e.value.trim()?t.push({op:"set",key:r,value:e.value.trim(),category:"autoclick",description:"proxy url"}):t.push({op:"unset",key:r})}),t.push({op:"set",key:"AutoClick_HTTP_Concurrency",value:h||"10",category:"autoclick",description:"http concurrency"}),t.push({op:"set",key:"AutoClick_Browser_Concurrency",value:y||"3",category:"autoclick",description:"browser concurrency"}),t.push({op:"set",key:"AutoClick_MaxStepPerTick",value:k||"3",category:"autoclick",description:"max step per tick"}),g?t.push({op:"set",key:"AutoClick_User_RPM",value:g,category:"autoclick",description:"per-user rpm"}):t.push({op:"unset",key:"AutoClick_User_RPM"}),b?t.push({op:"set",key:"AutoClick_Browser_Executor_URL",value:b,category:"autoclick",description:"browser executor url"}):t.push({op:"unset",key:"AutoClick_Browser_Executor_URL"}),!(await fetch("/ops/api/v1/console/system/config/batch",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw Error("batch save failed");x("保存成功（正在热更新）")}catch(e){x("保存失败")}n(!1)},f=async e=>{if(!e||!e.trim())return void alert("请输入代理地址");try{var t;let a=await fetch("/api/batchopen/proxy-url-validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proxyUrl:e.trim()})}),s=await a.json();a.ok&&null!=(t=null==s?void 0:s.valid)&&t?alert("代理可用"):alert("无效代理：".concat((null==s?void 0:s.message)||"unknown"))}catch(e){alert("验证失败")}};return(0,s.jsx)(c.OZ,{title:"AutoClick 配置",description:"通过系统配置热更新 Proxy 与方差",children:(0,s.jsx)("div",{className:"space-y-4",children:u?(0,s.jsx)("div",{className:"text-gray-500",children:"加载中..."}):(0,s.jsxs)("div",{className:"".concat(l.B8.cards.simple," p-6 space-y-4"),children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm text-gray-600 mb-2",children:["国家代理（Proxy_URL_","{COUNTRY}",")"]}),(0,s.jsxs)("div",{className:"space-y-2",children:[a.map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,s.jsx)("input",{className:"col-span-2 border rounded px-3 py-2",value:e.code,onChange:e=>{let a=e.target.value.toUpperCase();o(e=>e.map((e,s)=>s===t?{...e,code:a}:e))},placeholder:"US"}),(0,s.jsx)("textarea",{className:"col-span-9 border rounded px-3 py-2 min-h-[60px]",value:e.value,onChange:e=>o(a=>a.map((a,s)=>s===t?{...a,value:e.target.value}:a)),placeholder:"http://user:pass@ip:port 或代理拉取接口"}),(0,s.jsxs)("div",{className:"col-span-1 flex flex-col gap-2",children:[(0,s.jsx)("button",{className:l.B8.buttons.outline,onClick:()=>f(e.value),children:"验证"}),(0,s.jsx)("button",{className:l.B8.buttons.outline,onClick:()=>o(e=>e.filter((e,a)=>a!==t)),children:"移除"})]})]},t)),(0,s.jsx)("div",{children:(0,s.jsx)("button",{className:l.B8.buttons.outline,onClick:()=>o(e=>[...e,{code:"",value:""}]),children:"添加国家"})})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"留空即为禁用该国家默认代理"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"HTTP 并发（AutoClick_HTTP_Concurrency）"}),(0,s.jsx)("input",{type:"number",min:1,className:"w-48 border rounded px-3 py-2",value:h,onChange:e=>m(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"浏览器并发（AutoClick_Browser_Concurrency）"}),(0,s.jsx)("input",{type:"number",min:1,className:"w-48 border rounded px-3 py-2",value:y,onChange:e=>v(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"每 Tick 最大推进（AutoClick_MaxStepPerTick）"}),(0,s.jsx)("input",{type:"number",min:1,className:"w-48 border rounded px-3 py-2",value:k,onChange:e=>_(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"用户 RPM（AutoClick_User_RPM，可选）"}),(0,s.jsx)("input",{type:"number",min:0,className:"w-48 border rounded px-3 py-2",value:g,onChange:e=>C(e.target.value)})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"浏览器执行器 URL（AutoClick_Browser_Executor_URL）"}),(0,s.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:b,onChange:e=>j(e.target.value),placeholder:"http://next-host/api/executor/puppeteer 或独立执行器地址"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"配置后将通过该地址执行真实浏览器访问"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"AutoClick_Count_Variance_Hour"}),(0,s.jsx)("input",{type:"number",min:0,max:.9,step:.05,className:"w-48 border rounded px-3 py-2",value:e,onChange:e=>t(e.target.value)}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"每小时目标值的随机方差（建议 0.2~0.4）"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{className:l.B8.buttons.primary,onClick:N,disabled:i,children:"保存配置"}),d&&(0,s.jsx)("span",{className:"text-sm text-gray-600",children:d})]})]})})})}},98531:(e,t,a)=>{Promise.resolve().then(a.bind(a,12428))}},e=>{var t=t=>e(e.s=t);e.O(0,[2076,4121,7358],()=>t(98531)),_N_E=e.O()}]);