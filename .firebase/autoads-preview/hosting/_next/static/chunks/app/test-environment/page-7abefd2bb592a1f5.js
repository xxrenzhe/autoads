(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4495],{6906:(e,s,a)=>{Promise.resolve().then(a.bind(a,56947))},56947:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>p});var r=a(54568),t=a(7620),l=a(63353),n=a(47227),i=a(64148),c=a(18529),o=a(90721),d=a(80035),m=a(39756),x=a(12463),h=a(20864),u=a(24334);function p(){let[e,s]=(0,t.useState)([]),[a,p]=(0,t.useState)(null),[j,g]=(0,t.useState)(!1),[b,f]=(0,t.useState)(!1),[y,N]=(0,t.useState)("idle"),v=async()=>{try{g(!0);let e=[],a=(0,u.pT)();e.push({name:"Environment Detection",status:"success",message:"检测到: ".concat(a),details:{environment:a}});let r=(0,u.d0)();e.push({name:"Domain Configuration",status:"success",message:"域名: ".concat(r.domain),details:{domain:r.domain,baseUrl:r.baseUrl,isLocal:r.isLocal,isHttps:r.isHttps,apiBaseUrl:r.apiBaseUrl}});let t=(0,u.RV)(r.domain);e.push({name:"Domain Validation",status:t?"success":"error",message:t?"域名在允许列表中":"域名不在允许列表中",details:{domainAllowed:t,domain:r.domain}});let l=(0,u.xO)(),n=!!l.clientId,i=!!l.developerToken;e.push({name:"OAuth Configuration",status:n&&i?"success":"warning",message:n&&i?"OAuth 配置完整":"缺少 OAuth 凭据",details:{hasClientId:n,hasDeveloperToken:i,redirectUri:l.redirectUri,scope:l.scope}});let c=r.isHttps||r.isLocal;e.push({name:"HTTPS Configuration",status:c?"success":"error",message:c?r.isLocal?"开发环境允许使用 HTTP":"HTTPS 已正确配置":"需要 HTTPS 但未检测到",details:{isHttps:r.isHttps,isLocal:r.isLocal,enableHttps:r.enableHttps}});let o={secureCookies:r.secureCookies,enableHttps:r.enableHttps,allowedDomains:["localhost:3000","autoads.dev"]};e.push({name:"Security Configuration",status:"success",message:"安全设置已应用",details:o});let d={analytics:r.enableAnalytics,errorReporting:r.enableErrorReporting,performanceMonitoring:r.enablePerformanceMonitoring,debugMode:r.debugMode};e.push({name:"Feature Flags",status:"success",message:"功能标志已配置",details:d});let m=(0,u.pT)(),x=(0,u.d0)();p({environment:m,domain:x.domain,baseUrl:x.baseUrl,isLocal:x.isLocal,isHttps:x.isHttps,features:{analytics:x.enableAnalytics,errorReporting:x.enableErrorReporting,performanceMonitoring:x.enablePerformanceMonitoring,debugMode:x.debugMode},security:{httpsOnly:x.enableHttps&&!x.isLocal}}),s(e)}catch(e){console.error("Error running tests:",e),s([{name:"Test Suite",status:"error",message:e instanceof Error?e.message:"发生未知错误",details:{error:e instanceof Error?e.stack:"Unknown error"}}])}finally{g(!1)}},w=async e=>{if(!e)return void console.warn("No text provided to copy");f(!0),N("idle");try{if(navigator.clipboard)await navigator.clipboard.writeText(e),console.log("URL已复制到剪贴板:",e),N("success"),setTimeout(()=>N("idle"),2e3);else{let s=document.createElement("textarea");s.value=e,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();try{document.execCommand("copy"),console.log("URL已复制到剪贴板 (fallback):",e),N("success"),setTimeout(()=>N("idle"),2e3)}catch(e){throw console.error("复制失败 (fallback):",e),N("error"),Error("复制失败，请手动复制")}finally{document.body.removeChild(s)}}}catch(e){throw console.error("复制失败:",e),N("error"),e}finally{f(!1)}};(0,t.useEffect)(()=>{v()},[]);let T=e=>{switch(e){case"success":return(0,r.jsx)(c.A,{className:"h-5 w-5 text-green-600"});case"error":return(0,r.jsx)(o.A,{className:"h-5 w-5 text-red-600"});case"warning":return(0,r.jsx)(d.A,{className:"h-5 w-5 text-yellow-600"})}},H=e=>{switch(e){case"success":return(0,r.jsx)(i.E,{variant:"default",className:"bg-green-100 text-green-800",children:"通过"});case"error":return(0,r.jsx)(i.E,{variant:"destructive",children:"失败"});case"warning":return(0,r.jsx)(i.E,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:"警告"})}};return(0,r.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-6xl",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"环境配置测试"}),(0,r.jsx)("p",{className:"text-gray-600",children:"验证您的环境配置在开发、预览和生产环境中是否正常工作。"})]}),a&&(0,r.jsxs)(l.Zp,{className:"mb-6",children:[(0,r.jsx)(l.aR,{children:(0,r.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"当前环境"}),(0,r.jsx)(i.E,{variant:"outline",children:a.environment})]})}),(0,r.jsx)(l.Wu,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"域名:"})," ",a.domain]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"基础URL:"})," ",a.baseUrl]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"本地环境:"})," ",a.isLocal?"是":"否"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"HTTPS:"})," ",a.isHttps?"是":"否"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"分析功能:"})," ",a.features.analytics?"已启用":"已禁用"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"错误报告:"})," ",a.features.errorReporting?"已启用":"已禁用"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"调试模式:"})," ",a.features.debugMode?"已启用":"已禁用"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"仅HTTPS:"})," ",a.security.httpsOnly?"已启用":"已禁用"]})]})]})})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"测试结果"}),(0,r.jsxs)(n.$,{onClick:v,disabled:j,size:"sm",children:[(0,r.jsx)(m.A,{className:"h-4 w-4 mr-2 ".concat(j?"animate-spin":"")}),j?"正在运行测试...":"重新运行测试"]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.map((e,s)=>(0,r.jsx)(l.Zp,{children:(0,r.jsx)(l.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[T(e.status),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.message}),e.details&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"text-xs text-gray-500 cursor-pointer hover:text-gray-700",children:"查看详情"}),(0,r.jsx)("pre",{className:"mt-2 text-xs bg-gray-100 p-2 rounded overflow-x-auto",children:JSON.stringify(e.details,null,2)})]})]})]}),H(e.status)]})})},s))})]}),(0,r.jsxs)(l.Zp,{children:[(0,r.jsxs)(l.aR,{children:[(0,r.jsx)(l.ZB,{children:"快速操作"}),(0,r.jsx)(l.BT,{children:"环境管理的有用链接和工具"})]}),(0,r.jsx)(l.Wu,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)(n.$,{variant:"outline",onClick:async()=>{try{await w((null==a?void 0:a.baseUrl)||"")}catch(e){console.error("复制失败:",e)}},disabled:b||!(null==a?void 0:a.baseUrl),className:"justify-start",children:[b?(0,r.jsx)(m.A,{className:"h-4 w-4 mr-2 animate-spin"}):"success"===y?(0,r.jsx)(c.A,{className:"h-4 w-4 mr-2 text-green-600"}):"error"===y?(0,r.jsx)(o.A,{className:"h-4 w-4 mr-2 text-red-600"}):(0,r.jsx)(x.A,{className:"h-4 w-4 mr-2"}),b?"正在复制...":"success"===y?"已复制!":"error"===y?"复制失败":"复制基础URL"]}),(0,r.jsxs)(n.$,{variant:"outline",onClick:()=>window.open("/api/health","_blank"),className:"justify-start",children:[(0,r.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"检查健康状态端点"]}),(0,r.jsxs)(n.$,{variant:"outline",onClick:()=>window.open("https://console.cloud.google.com/","_blank"),className:"justify-start",children:[(0,r.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Google Cloud 控制台"]}),(0,r.jsxs)(n.$,{variant:"outline",onClick:()=>window.open("https://vercel.com/dashboard","_blank"),className:"justify-start",children:[(0,r.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Vercel 仪表板"]})]})})]}),(0,r.jsxs)(l.Zp,{className:"mt-6",children:[(0,r.jsx)(l.aR,{children:(0,r.jsx)(l.ZB,{children:"环境文档"})}),(0,r.jsx)(l.Wu,{children:(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"开发环境:"})," 在 localhost:3000 上使用 HTTP，启用调试功能"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"预览环境:"})," 自动部署的 Vercel 预览版，使用 HTTPS 和调试模式"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"生产环境:"})," 在 autoads.dev 上仅使用 HTTPS，具备所有安全功能"]})]})})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2076,4121,7358],()=>s(6906)),_N_E=e.O()}]);