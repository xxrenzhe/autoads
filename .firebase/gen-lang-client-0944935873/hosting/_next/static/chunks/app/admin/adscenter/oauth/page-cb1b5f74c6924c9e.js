(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5902],{1758:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>u});var t=r(54568),l=r(7620),a=r(63353),i=r(47227),o=r(65165),d=r(67474),n=r(17129),c=r(51874),h=r(89223);function u(){let{data:e}=(0,h.useSession)();(0,l.useEffect)(()=>{var s;let r=null==e||null==(s=e.user)?void 0:s.role;r&&"ADMIN"===String(r).toUpperCase()||(window.location.href="/ops/console/login")},[e]);let[s,r]=(0,l.useState)(""),[u,p]=(0,l.useState)("https://www.googleapis.com/auth/adwords openid email"),[m,v]=(0,l.useState)(""),[g,x]=(0,l.useState)(""),[j,f]=(0,l.useState)(""),[C,S]=(0,l.useState)(""),[k,N]=(0,l.useState)(""),[w,I]=(0,l.useState)(""),y=async()=>{if(!s.trim())return void c.oR.error("请输入 redirectUri");let e=await fetch("/api/v2/admin/adscenter/google-ads/oauth/link",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({redirectUri:s,scopes:u.split(/\s+/).filter(Boolean),clientId:m.trim()||void 0})}),r=await e.json().catch(()=>({}));if(!e.ok||!(null==r?void 0:r.authUrl))return void c.oR.error((null==r?void 0:r.message)||"生成失败");x(r.authUrl),c.oR.success("已生成授权链接")},b=async()=>{if(!j.trim()||!s.trim()||!C.trim()||!k.trim())return void c.oR.error("请填写 code/redirectUri/userId/customerId");let e={code:j.trim(),redirectUri:s.trim(),userId:C.trim(),customerId:k.trim()};m.trim()&&(e.clientId=m.trim()),w.trim()&&(e.clientSecret=w.trim());let r=await fetch("/api/v2/admin/adscenter/google-ads/oauth/callback",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}),t=await r.json().catch(()=>({}));if(!r.ok||(null==t?void 0:t.ok)!==!0)return void c.oR.error((null==t?void 0:t.message)||"回调处理失败");c.oR.success("OAuth 凭据已保存")};return(0,t.jsxs)("div",{className:"max-w-3xl mx-auto p-6 space-y-6",children:[(0,t.jsxs)(a.Zp,{className:"p-6 space-y-3",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",children:"生成授权链接"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{children:"Redirect URI"}),(0,t.jsx)(o.p,{value:s,onChange:e=>r(e.target.value),placeholder:"https://yourapp.com/oauth/callback"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{children:"Client ID（可选，未填则读取 system_configs）"}),(0,t.jsx)(o.p,{value:m,onChange:e=>v(e.target.value),placeholder:"Google OAuth Client ID"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{children:"Scopes（空格分隔）"}),(0,t.jsx)(n.T,{rows:2,value:u,onChange:e=>p(e.target.value)})]}),(0,t.jsx)(i.$,{onClick:y,children:"生成授权链接"}),g&&(0,t.jsx)("div",{className:"text-sm break-all",children:(0,t.jsx)("a",{className:"text-blue-600 underline",href:g,target:"_blank",rel:"noreferrer",children:g})})]}),(0,t.jsxs)(a.Zp,{className:"p-6 space-y-3",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",children:"回调处理（粘贴 code）"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{children:"Authorization Code"}),(0,t.jsx)(o.p,{value:j,onChange:e=>f(e.target.value),placeholder:"从 redirectUri 中拿到的 code 参数"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{children:"User ID"}),(0,t.jsx)(o.p,{value:C,onChange:e=>S(e.target.value),placeholder:"绑定到哪个用户"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{children:"Customer ID"}),(0,t.jsx)(o.p,{value:k,onChange:e=>N(e.target.value),placeholder:"Google Ads Customer ID 或 mock"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{children:"Client ID（可选）"}),(0,t.jsx)(o.p,{value:m,onChange:e=>v(e.target.value),placeholder:"如与系统配置不一致可覆盖"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.J,{children:"Client Secret（可选）"}),(0,t.jsx)(o.p,{value:w,onChange:e=>I(e.target.value),placeholder:"可覆盖系统配置"})]})]}),(0,t.jsx)(i.$,{onClick:b,children:"提交回调"})]})]})}},53531:(e,s,r)=>{Promise.resolve().then(r.bind(r,1758))}},e=>{var s=s=>e(e.s=s);e.O(0,[2076,4121,7358],()=>s(53531)),_N_E=e.O()}]);