(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5027],{42954:(e,s,t)=>{Promise.resolve().then(t.bind(t,62675))},62675:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>T});var a=t(54568),n=t(7620),l=t(89223),d=t(63353),r=t(64148),i=t(47227),c=t(89609),x=t(81872),o=t(28359),h=t(39756),m=t(73146),j=t(9132),u=t(56914),p=t(44023),f=t(2884),v=t(6541),N=t(20985),g=t(3722),b=t(22878),y=t(63626),w=t(82741),k=t(55326),A=t(73297),B=t(12344);function T(){var e;let{data:s}=(0,l.useSession)(),[t,T]=(0,n.useState)(null),[C,S]=(0,n.useState)(!0),[Z,O]=(0,n.useState)("7d"),[H,R]=(0,n.useState)("all"),[F,M]=(0,n.useState)(1),[W,E]=(0,n.useState)(!1),[z,I]=(0,n.useState)(null),[_,P]=(0,n.useState)(null),[$,q]=(0,n.useState)(!1),{data:D}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(0,A.I)({queryKey:["backend","tokens","transactions",e,s],queryFn:async()=>B.H.get("/api/tokens/transactions",{page:e,limit:s}),staleTime:3e4})}(1,5);(0,n.useEffect)(()=>{(null==s?void 0:s.user)&&U()},[s,Z,H,F,W]);let U=async()=>{try{S(!0);let e=new URLSearchParams({timeRange:Z,feature:H,page:F.toString(),limit:"20",includeBatchDetails:W.toString()}),s=await fetch("/api/user/tokens?".concat(e));if(s.ok){let e=await s.json();T(e)}}catch(e){console.error("获取Token数据失败:",e)}finally{S(!1)}},X=async e=>{try{q(!0);let s=await fetch("/api/user/tokens/batch/".concat(e));if(s.ok){let t=await s.json();P(t.data),I(e)}}catch(e){console.error("获取批量操作详情失败:",e)}finally{q(!1)}},L=e=>({siterank:"SiteRank 域名分析",batchopen:"BatchOpen 批量访问",adscenter:"AdsCenter 自动化广告"})[e]||e,V=e=>{switch(e){case"siterank":return"\uD83D\uDD0D";case"batchopen":return"\uD83D\uDE80";case"adscenter":return"\uD83D\uDD17";default:return"⚡"}},G=e=>e.description,K=e=>{M(e)},J=e=>{X(e)};return s?(0,a.jsxs)("div",{className:"container mx-auto py-8 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Token 使用记录"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"查看您的Token消耗情况和使用历史"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(i.$,{onClick:U,disabled:C,children:[(0,a.jsx)(h.A,{className:"h-4 w-4 mr-2 ".concat(C?"animate-spin":"")}),"刷新"]}),(0,a.jsx)(i.$,{variant:"outline",asChild:!0,children:(0,a.jsxs)("a",{href:"/api/user/tokens/stats",target:"_blank",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"详细统计"]})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{className:"text-sm font-medium",children:"当前余额"}),(0,a.jsx)(j.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,a.jsx)(k.A,{fallback:(null==t?void 0:t.data.currentBalance)||0})}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"可用Token数量"})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{className:"text-sm font-medium",children:"总消耗"}),(0,a.jsx)(u.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:(null==t?void 0:t.data.stats.totalTokensUsed)||0}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["7d"===Z?"近7天":"30d"===Z?"近30天":"所有时间","消耗"]})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{className:"text-sm font-medium",children:"总操作数"}),(0,a.jsx)(p.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:(null==t?void 0:t.data.stats.totalOperations)||0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"实际操作次数"})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{className:"text-sm font-medium",children:"批量操作"}),(0,a.jsx)(m.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:(null==t?void 0:t.data.stats.batchOperations.count)||0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"批量操作次数"})]})]})]}),(null==t?void 0:t.data.stats.byFeature)&&Object.keys(t.data.stats.byFeature).length>0&&(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsx)(d.ZB,{children:"功能使用分布"}),(0,a.jsx)(d.BT,{children:"各功能的Token消耗和操作统计"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(t.data.stats.byFeature).map(e=>{let[s,n]=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:V(s)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:L(s)}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["消耗 ",n.amount," Token \xb7 ",n.operations," 次操作"]})]})]}),(0,a.jsxs)(r.E,{variant:"secondary",children:[Math.round(n.amount/(t.data.stats.totalTokensUsed||1)*100),"%"]})]},s)})})})]}),Array.isArray(null==D?void 0:D.records)&&D.records.length>0&&(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsx)(d.ZB,{children:"最近交易（后端实时）"}),(0,a.jsx)(d.BT,{children:"展示最近5条 Token 变动记录"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsxs)(c.XI,{children:[(0,a.jsx)(c.A0,{children:(0,a.jsxs)(c.Hj,{children:[(0,a.jsx)(c.nd,{children:"时间"}),(0,a.jsx)(c.nd,{children:"功能"}),(0,a.jsx)(c.nd,{children:"操作"}),(0,a.jsx)(c.nd,{children:"消耗"}),(0,a.jsx)(c.nd,{children:"余额"})]})}),(0,a.jsx)(c.BF,{children:D.records.map(e=>(0,a.jsxs)(c.Hj,{children:[(0,a.jsx)(c.nA,{children:e.timestamp?(0,y.A)(new Date(e.timestamp),"yyyy-MM-dd HH:mm:ss",{locale:w.A}):"-"}),(0,a.jsx)(c.nA,{children:e.feature||"-"}),(0,a.jsx)(c.nA,{children:e.action||"-"}),(0,a.jsx)(c.nA,{children:"number"==typeof e.amount?e.amount:"-"}),(0,a.jsx)(c.nA,{children:"number"==typeof e.balance?e.balance:"-"})]},e.id))})]})})]}),(null==t||null==(e=t.data.stats.batchOperations)?void 0:e.count)&&t.data.stats.batchOperations.count>0&&(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsx)(d.ZB,{children:"批量操作统计"}),(0,a.jsx)(d.BT,{children:"批量操作的效率分析"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"text-center p-4 border rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:null==t?void 0:t.data.stats.batchOperations.count}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"批量操作次数"})]}),(0,a.jsxs)("div",{className:"text-center p-4 border rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:Math.round((null==t?void 0:t.data.stats.batchOperations.avgBatchSize)||0)}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"平均批次大小"})]}),(0,a.jsxs)("div",{className:"text-center p-4 border rounded-lg",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-purple-600",children:[Math.round(((null==t?void 0:t.data.stats.batchOperations.totalTokens)||0)/((null==t?void 0:t.data.stats.totalTokensUsed)||1)*100),"%"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"批量操作占比"})]})]})})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.ZB,{children:"使用记录"}),(0,a.jsx)(d.BT,{children:"详细的Token消耗历史记录"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(x.l6,{value:Z,onValueChange:O,children:[(0,a.jsx)(x.bq,{className:"w-32",children:(0,a.jsx)(x.yv,{})}),(0,a.jsxs)(x.gC,{children:[(0,a.jsx)(x.eb,{value:"7d",children:"近7天"}),(0,a.jsx)(x.eb,{value:"30d",children:"近30天"}),(0,a.jsx)(x.eb,{value:"90d",children:"近90天"}),(0,a.jsx)(x.eb,{value:"all",children:"所有时间"})]})]}),(0,a.jsxs)(x.l6,{value:H,onValueChange:R,children:[(0,a.jsx)(x.bq,{className:"w-40",children:(0,a.jsx)(x.yv,{})}),(0,a.jsxs)(x.gC,{children:[(0,a.jsx)(x.eb,{value:"all",children:"所有功能"}),(0,a.jsx)(x.eb,{value:"siterank",children:"SiteRank"}),(0,a.jsx)(x.eb,{value:"batchopen",children:"BatchOpen"}),(0,a.jsx)(x.eb,{value:"adscenter",children:"AdsCenter"})]})]}),(0,a.jsxs)(i.$,{variant:W?"default":"outline",size:"sm",onClick:()=>E(!W),children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-2"}),W?"隐藏详情":"显示详情"]})]})]})}),(0,a.jsx)(d.Wu,{children:C?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(h.A,{className:"h-6 w-6 animate-spin mr-2"}),(0,a.jsx)("span",{children:"加载中..."})]}):(null==t?void 0:t.data.records)&&t.data.records.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.XI,{children:[(0,a.jsx)(c.A0,{children:(0,a.jsxs)(c.Hj,{children:[(0,a.jsx)(c.nd,{children:"功能"}),(0,a.jsx)(c.nd,{children:"操作描述"}),(0,a.jsx)(c.nd,{children:"消耗Token"}),(0,a.jsx)(c.nd,{children:"余额"}),(0,a.jsx)(c.nd,{children:"时间"}),(0,a.jsx)(c.nd,{children:"操作"})]})}),(0,a.jsx)(c.BF,{children:t.data.records.map(e=>(0,a.jsxs)(c.Hj,{children:[(0,a.jsx)(c.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:V(e.feature)}),(0,a.jsx)("span",{className:"font-medium",children:L(e.feature)})]})}),(0,a.jsx)(c.nA,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:G(e)}),(0,a.jsxs)("div",{className:"flex gap-1 mt-1",children:[e.isBatch&&(0,a.jsxs)(r.E,{variant:"outline",children:["批量操作 (",e.batchSize,"项)"]}),(0,a.jsx)(r.E,{variant:"secondary",className:"text-xs",children:e.action})]})]})}),(0,a.jsx)(c.nA,{children:(0,a.jsxs)(r.E,{variant:e.amount>10?"destructive":"secondary",children:["-",e.amount]})}),(0,a.jsx)(c.nA,{className:"text-muted-foreground",children:e.balance}),(0,a.jsx)(c.nA,{className:"text-muted-foreground",children:(0,y.A)(new Date(e.timestamp),"yyyy-MM-dd HH:mm",{locale:w.A})}),(0,a.jsx)(c.nA,{children:e.isBatch&&e.batchId&&(0,a.jsxs)(o.lG,{children:[(0,a.jsx)(o.zM,{asChild:!0,children:(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>J(e.batchId),children:(0,a.jsx)(v.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(o.Cf,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(o.c7,{children:[(0,a.jsx)(o.L3,{children:"批量操作详情"}),(0,a.jsx)(o.rr,{children:"查看批量操作的具体内容和统计信息"})]}),$?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(h.A,{className:"h-6 w-6 animate-spin mr-2"}),(0,a.jsx)("span",{children:"加载详情中..."})]}):_&&z===e.batchId?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,a.jsx)("div",{className:"text-lg font-bold",children:_.operationCount}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"操作数量"})]}),(0,a.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,a.jsx)("div",{className:"text-lg font-bold",children:_.totalAmount}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"总消耗Token"})]}),(0,a.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,a.jsx)("div",{className:"text-lg font-bold",children:_.summary.averageTokensPerOperation.toFixed(1)}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"平均消耗"})]}),(0,a.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,a.jsx)("div",{className:"text-lg font-bold",children:(0,y.A)(new Date(_.timestamp),"HH:mm:ss")}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"执行时间"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"操作详情"}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto border rounded",children:(0,a.jsxs)(c.XI,{children:[(0,a.jsx)(c.A0,{children:(0,a.jsxs)(c.Hj,{children:[(0,a.jsx)(c.nd,{className:"w-16",children:"#"}),(0,a.jsx)(c.nd,{children:"描述"}),(0,a.jsx)(c.nd,{className:"w-20",children:"Token"})]})}),(0,a.jsx)(c.BF,{children:_.operations.map(e=>(0,a.jsxs)(c.Hj,{children:[(0,a.jsx)(c.nA,{children:e.index}),(0,a.jsx)(c.nA,{className:"font-mono text-sm",children:e.description}),(0,a.jsx)(c.nA,{children:e.amount})]},e.index))})]})})]})]}):null]})]})})]},e.id))})]}),t.data.pagination.totalPages>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["显示 ",(t.data.pagination.page-1)*t.data.pagination.limit+1," - ",Math.min(t.data.pagination.page*t.data.pagination.limit,t.data.pagination.total),"，共 ",t.data.pagination.total," 条记录"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>K(F-1),disabled:F<=1,children:[(0,a.jsx)(N.A,{className:"h-4 w-4"}),"上一页"]}),(0,a.jsxs)("span",{className:"text-sm",children:["第 ",F," 页，共 ",t.data.pagination.totalPages," 页"]}),(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>K(F+1),disabled:F>=t.data.pagination.totalPages,children:["下一页",(0,a.jsx)(g.A,{className:"h-4 w-4"})]})]})]})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(b.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"暂无使用记录"})]})})]})]}):(0,a.jsx)("div",{className:"container mx-auto py-8",children:(0,a.jsx)(d.Zp,{children:(0,a.jsx)(d.Wu,{className:"pt-6",children:(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:"请先登录查看Token使用记录"})})})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2076,4121,7358],()=>s(42954)),_N_E=e.O()}]);