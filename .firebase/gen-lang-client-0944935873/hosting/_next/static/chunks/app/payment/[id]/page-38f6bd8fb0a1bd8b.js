(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5455],{25307:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>j,dynamic:()=>p});var a=l(54568),c=l(89223),n=l(62942),i=l(7620),r=l(47227),t=l(63353),d=l(64148),x=l(70111),m=l(18529),u=l(40860),h=l(51747),o=l(8039);let p="force-dynamic";function j(e){var s,l,p,j,N,f;let{params:v}=e,{data:y,status:g}=(0,c.useSession)(),b=(0,n.useRouter)();(0,n.useSearchParams)();let[w,E]=(0,i.useState)(null),[S,T]=(0,i.useState)(!1),[_,k]=(0,i.useState)("pending");(0,i.useEffect)(()=>{if("unauthenticated"===g)return void b.push("/auth/signin");A()},[g,b,v.id]);let A=async()=>{try{let e=await o.L.get("/subscriptions/".concat(v.id));E(e)}catch(e){console.error("Error fetching subscription:",e)}},B=async()=>{T(!0),k("processing");try{let e=await o.L.post("/payments/create",{subscriptionId:v.id,amount:null==w?void 0:w.plan.price,currency:null==w?void 0:w.plan.currency});e.redirectUrl?window.location.href=e.redirectUrl:(k("completed"),setTimeout(()=>{b.push("/payment/success")},2e3))}catch(e){console.error("Error processing payment:",e),k("failed")}finally{T(!1)}};if(!w)return(0,a.jsx)("div",{children:"Loading..."});let O=(e=>{try{return JSON.parse(e)}catch(e){return[]}})(null==(s=w.plan)?void 0:s.features);return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"完成支付"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["您正在订阅 ",null==(l=w.plan)?void 0:l.name," 套餐"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)(t.Zp,{children:[(0,a.jsxs)(t.aR,{children:[(0,a.jsx)(t.ZB,{children:"订单摘要"}),(0,a.jsx)(t.BT,{children:"请确认您的订阅详情"})]}),(0,a.jsxs)(t.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"套餐"}),(0,a.jsx)(d.E,{variant:"outline",children:null==(p=w.plan)?void 0:p.name})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"价格"}),(0,a.jsxs)("span",{className:"text-2xl font-bold",children:["$",null==(j=w.plan)?void 0:j.price,"/",(null==(N=w.plan)?void 0:N.interval)==="MONTH"?"月":"年"]})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"包含功能："}),(0,a.jsx)("ul",{className:"space-y-2",children:O.map((e,s)=>(0,a.jsxs)("li",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(m.A,{className:"w-4 h-4 text-green-500 mr-2"}),"object"==typeof e?e.name:e,"object"==typeof e&&e.value&&(0,a.jsxs)("span",{className:"text-blue-600 font-medium ml-1",children:["(",e.value," ",e.unit,")"]})]},s))})]})]})]}),(0,a.jsxs)(t.Zp,{children:[(0,a.jsxs)(t.aR,{children:[(0,a.jsxs)(t.ZB,{className:"flex items-center",children:[(0,a.jsx)(u.A,{className:"mr-2 h-5 w-5"}),"支付信息"]}),(0,a.jsx)(t.BT,{children:"安全支付，由 Wise 处理"})]}),(0,a.jsxs)(t.Wu,{className:"space-y-4",children:["completed"===_&&(0,a.jsxs)(x.Fc,{children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),(0,a.jsx)(x.TN,{children:"支付成功！正在跳转..."})]}),"failed"===_&&(0,a.jsx)(x.Fc,{variant:"destructive",children:(0,a.jsx)(x.TN,{children:"支付失败，请重试"})}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(h.A,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,a.jsx)("span",{className:"font-medium text-blue-900",children:"安全支付保障"})]}),(0,a.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,a.jsx)("li",{children:"• 使用 Wise 安全支付网关"}),(0,a.jsx)("li",{children:"• 支持多种支付方式"}),(0,a.jsx)("li",{children:"• 7天无理由退款"})]})]}),(0,a.jsx)(r.$,{onClick:B,disabled:S||"processing"===_,className:"w-full",size:"lg",children:S?"处理中...":"processing"===_?"正在处理...":"支付 $".concat(null==(f=w.plan)?void 0:f.price)}),(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"点击支付即表示您同意我们的服务条款和隐私政策"})]})]})]})]})})}},83206:(e,s,l)=>{Promise.resolve().then(l.bind(l,25307))}},e=>{var s=s=>e(e.s=s);e.O(0,[2076,4121,7358],()=>s(83206)),_N_E=e.O()}]);