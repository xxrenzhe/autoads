(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7467],{32731:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>U});var n=t(54568),c=t(7620),l=t(47227),a=t(63353),r=t(64148),i=t(18529),o=t(80035),d=t(90721),h=t(62708),x=t(38007),_=t(65837),m=t(6541),u=t(20864),E=t(39756),N=t(93059),I=t(72825),j=t(28359),v=t(65165),A=t(67474),p=t(70111),T=t(68267),g=t(40459);let C={DOMAIN:g.env.NEXT_PUBLIC_DOMAIN||"autoads.dev",BASE_URL:g.env.NEXT_PUBLIC_BASE_URL||"https://autoads.dev",OAUTH_REDIRECT_URI:g.env.NEXT_PUBLIC_OAUTH_REDIRECT_URI||"https://autoads.dev/oauth/callback",API_BASE_URL:g.env.NEXT_PUBLIC_BASE_URL?"".concat(g.env.NEXT_PUBLIC_BASE_URL,"/api"):"https://autoads.dev/api",ADSPOWER_API_URL:g.env.NEXT_PUBLIC_ADSPOWER_API_URL||"http://local.adspower.net:50325",GOOGLE_ADS_API_VERSION:g.env.NEXT_PUBLIC_GOOGLE_ADS_API_VERSION||"v14",GOOGLE_ADS_SCOPE:g.env.NEXT_PUBLIC_GOOGLE_ADS_SCOPE||"https://www.googleapis.com/auth/adwords",HTTPS_ONLY:"true"===g.env.NEXT_PUBLIC_HTTPS_ONLY,SECURE_COOKIES:"true"===g.env.NEXT_PUBLIC_SECURE_COOKIES,CACHE_TTL:300,REQUEST_TIMEOUT:parseInt(g.env.NEXT_PUBLIC_ADSPOWER_TIMEOUT||"30000"),FEATURES:{ANALYTICS:"true"===g.env.NEXT_PUBLIC_ENABLE_ANALYTICS,ERROR_REPORTING:"true"===g.env.NEXT_PUBLIC_ENABLE_ERROR_REPORTING,PERFORMANCE_MONITORING:"true"===g.env.NEXT_PUBLIC_ENABLE_PERFORMANCE_MONITORING,DEBUG_MODE:"true"===g.env.NEXT_PUBLIC_DEBUG_MODE}},O={DOMAIN:g.env.NEXT_PUBLIC_DOMAIN||"localhost:3000",BASE_URL:g.env.NEXT_PUBLIC_BASE_URL||"http://localhost:3000",OAUTH_REDIRECT_URI:g.env.NEXT_PUBLIC_OAUTH_REDIRECT_URI||"http://localhost:3000/oauth/callback",API_BASE_URL:g.env.NEXT_PUBLIC_BASE_URL?"".concat(g.env.NEXT_PUBLIC_BASE_URL,"/api"):"http://localhost:3000/api",ADSPOWER_API_URL:g.env.NEXT_PUBLIC_ADSPOWER_API_URL||"http://local.adspower.net:50325",GOOGLE_ADS_API_VERSION:g.env.NEXT_PUBLIC_GOOGLE_ADS_API_VERSION||"v14",GOOGLE_ADS_SCOPE:g.env.NEXT_PUBLIC_GOOGLE_ADS_SCOPE||"https://www.googleapis.com/auth/adwords",HTTPS_ONLY:"true"===g.env.NEXT_PUBLIC_HTTPS_ONLY,SECURE_COOKIES:"true"===g.env.NEXT_PUBLIC_SECURE_COOKIES,CACHE_TTL:60,REQUEST_TIMEOUT:parseInt(g.env.NEXT_PUBLIC_ADSPOWER_TIMEOUT||"10000"),FEATURES:{ANALYTICS:"true"===g.env.NEXT_PUBLIC_ENABLE_ANALYTICS,ERROR_REPORTING:"true"===g.env.NEXT_PUBLIC_ENABLE_ERROR_REPORTING,PERFORMANCE_MONITORING:"true"===g.env.NEXT_PUBLIC_ENABLE_PERFORMANCE_MONITORING,DEBUG_MODE:"true"===g.env.NEXT_PUBLIC_DEBUG_MODE}},S="autoads.dev"===window.location.hostname||window.location.hostname.includes("vercel.app")?C:O;var R=t(61866),L=t(69669);let P=(0,R.KV)("adscenter-accounts");function U(){let[e,s]=(0,c.useState)([]),[t,g]=(0,c.useState)(!0),[C,O]=(0,c.useState)(!1),[R,U]=(0,c.useState)(!1),[f,w]=(0,c.useState)(null),[B,G]=(0,c.useState)({}),[y,D]=(0,c.useState)({accountName:"",accountId:"",clientId:"",clientSecret:"",developerToken:""}),k=T.N;(0,c.useEffect)(()=>{X()},[]);let X=async()=>{try{var e;g(!0);let t=await k.getGoogleAdsAccounts(),n=null==t||null==(e=t.filter(Boolean))?void 0:e.map(e=>{var s;return{id:e.id,accountId:e.customerId,accountName:e.name,clientId:e.clientId,clientSecret:e.clientSecret,developerToken:e.developerToken,refreshToken:e.refreshToken,accessToken:"",expiresAt:e.refreshToken?Date.now()+36e5:void 0,status:e.refreshToken?"active":"expired",lastSync:null==(s=e.lastSync)?void 0:s.toISOString(),campaignCount:Math.floor(10*Math.random())+1,adGroupCount:Math.floor(50*Math.random())+5,adCount:Math.floor(200*Math.random())+20}});s(n)}catch(e){P.error("加载账户失败:",new L.$W("加载账户失败:",{error:e instanceof Error?e.message:String(e)})),s([])}finally{g(!1)}},b=async()=>{try{if(!y.accountName||!y.accountId||!y.clientId||!y.clientSecret||!y.developerToken)return void alert("请填写所有必填字段");await k.addGoogleAdsAccount({name:y.accountName,customerId:y.accountId,clientId:y.clientId,clientSecret:y.clientSecret,developerToken:y.developerToken,refreshToken:"",isActive:!1}),O(!1),Y(),X(),alert('账户已创建，请点击"授权访问"完成OAuth授权')}catch(e){P.error("创建账户失败:",new L.$W("创建账户失败:",{error:e instanceof Error?e.message:String(e)})),alert("创建账户失败")}},M=async()=>{if(f)try{await k.updateGoogleAdsAccount(f.id,{name:y.accountName,customerId:y.accountId,clientId:y.clientId,clientSecret:y.clientSecret,developerToken:y.developerToken}),U(!1),w(null),Y(),X()}catch(e){P.error("更新账户失败:",new L.$W("更新账户失败:",{error:e instanceof Error?e.message:String(e)})),alert("更新账户失败")}},$=async e=>{if(confirm("确定要删除这个账户吗？删除后将无法恢复。"))try{await k.deleteGoogleAdsAccount(e),X()}catch(e){P.error("删除账户失败:",new L.$W("删除账户失败:",{error:e instanceof Error?e.message:String(e)})),alert("删除账户失败")}},W=async e=>{try{let s=new URLSearchParams({client_id:e.clientId,redirect_uri:S.OAUTH_REDIRECT_URI,scope:S.GOOGLE_ADS_SCOPE,response_type:"code",access_type:"offline",prompt:"consent",state:e.id}),t="https://accounts.google.com/o/oauth2/v2/auth?".concat(s.toString()),n=window.open(t,"oauth","width=500,height=600"),c=setInterval(()=>{(null==n?void 0:n.closed)&&(clearInterval(c),setTimeout(()=>{X()},1e3))},1e3)}catch(e){P.error("OAuth授权失败:",new L.$W("OAuth授权失败:",{error:e instanceof Error?e.message:String(e)})),alert("OAuth授权失败")}},F=async e=>{try{await k.updateGoogleAdsAccount(e.id,{refreshToken:"new_refresh_token_"+Date.now()}),X(),alert("令牌刷新成功")}catch(e){P.error("刷新令牌失败:",new L.$W("刷新令牌失败:",{error:e instanceof Error?e.message:String(e)})),alert("刷新令牌失败")}},H=async e=>{try{alert("账户数据同步成功"),X()}catch(e){P.error("同步账户数据失败:",new L.$W("同步账户数据失败:",{error:e instanceof Error?e.message:String(e)})),alert("同步账户数据失败")}},Y=()=>{D({accountName:"",accountId:"",clientId:"",clientSecret:"",developerToken:""})},z=e=>{w(e),D({accountName:e.accountName,accountId:e.accountId,clientId:e.clientId,clientSecret:e.clientSecret,developerToken:""}),U(!0)},J=(e,s)=>{let t="".concat(e,"_").concat(s);G(e=>({...e,[t]:!e[t]}))},K=e=>{let s={active:i.A,expired:o.A,error:d.A}[e]||o.A;return(0,n.jsxs)(r.E,{className:"flex items-center gap-1",children:[(0,n.jsx)(s,{className:"h-3 w-3"}),{active:"已授权",expired:"已过期",error:"错误"}[e]||e]})},V=()=>(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(A.J,{htmlFor:"accountName",children:"账户名称 *"}),(0,n.jsx)(v.p,{id:"accountName",value:y.accountName,onChange:e=>D(s=>({...s,accountName:e.target.value})),placeholder:"输入账户名称"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(A.J,{htmlFor:"accountId",children:"Google Ads 账户 ID *"}),(0,n.jsx)(v.p,{id:"accountId",value:y.accountId,onChange:e=>D(s=>({...s,accountId:e.target.value})),placeholder:"10位数字账户ID"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(A.J,{htmlFor:"clientId",children:"客户端 ID *"}),(0,n.jsx)(v.p,{id:"clientId",value:y.clientId,onChange:e=>D(s=>({...s,clientId:e.target.value})),placeholder:"从 Google Cloud Console 获取"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(A.J,{htmlFor:"clientSecret",children:"客户端密钥 *"}),(0,n.jsx)(v.p,{id:"clientSecret",type:"password",value:y.clientSecret,onChange:e=>D(s=>({...s,clientSecret:e.target.value})),placeholder:"从 Google Cloud Console 获取"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(A.J,{htmlFor:"developerToken",children:"开发者令牌 *"}),(0,n.jsx)(v.p,{id:"developerToken",type:"password",value:y.developerToken,onChange:e=>D(s=>({...s,developerToken:e.target.value})),placeholder:"从 Google Ads API 中心获取"})]}),(0,n.jsxs)(p.Fc,{children:[(0,n.jsx)(o.A,{className:"h-4 w-4"}),(0,n.jsx)(p.TN,{children:"这些凭据将安全存储在您的本地浏览器中，不会上传到服务器。"})]})]});return t?(0,n.jsx)("div",{className:"container mx-auto p-6",children:(0,n.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{children:"加载账户中..."})]})})}):(0,n.jsxs)("div",{className:"container mx-auto p-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Google Ads 账号管理"}),(0,n.jsx)("p",{className:"text-gray-600",children:"管理您的 Google Ads 账号和授权状态"})]}),(0,n.jsxs)(j.lG,{open:C,onOpenChange:O,children:[(0,n.jsx)(j.zM,{asChild:!0,children:(0,n.jsxs)(l.$,{onClick:()=>{Y(),O(!0)},children:[(0,n.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"添加账号"]})}),(0,n.jsxs)(j.Cf,{className:"max-w-2xl",children:[(0,n.jsxs)(j.c7,{children:[(0,n.jsx)(j.L3,{children:"添加 Google Ads 账号"}),(0,n.jsx)(j.rr,{children:"添加新的 Google Ads 账号并配置 API 凭据"})]}),(0,n.jsx)(V,{}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,n.jsx)(l.$,{variant:"outline",onClick:()=>O(!1),children:"取消"}),(0,n.jsx)(l.$,{onClick:b,children:"添加账号"})]})]})]})]}),0===e.length?(0,n.jsx)(a.Zp,{children:(0,n.jsxs)(a.Wu,{className:"flex flex-col items-center justify-center py-12",children:[(0,n.jsx)(x.A,{className:"h-12 w-12 text-gray-400 mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-medium mb-2",children:"暂无 Google Ads 账号"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"添加您的第一个 Google Ads 账号来开始使用"}),(0,n.jsxs)(l.$,{onClick:()=>O(!0),children:[(0,n.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"添加账号"]})]})}):(0,n.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.map(e=>(0,n.jsxs)(a.Zp,{className:"hover:shadow-lg transition-shadow",children:[(0,n.jsx)(a.aR,{children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(a.ZB,{className:"text-lg",children:e.accountName}),(0,n.jsxs)(a.BT,{children:["账户 ID: ",e.accountId]})]}),K(e.status)]})}),(0,n.jsx)(a.Wu,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:e.campaignCount}),(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"广告系列"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:e.adGroupCount}),(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"广告组"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:e.adCount}),(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"广告"})]})]}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"客户端 ID:"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"font-mono",children:B["".concat(e.id,"_clientId")]?e.clientId:e.clientId.substring(0,8)+"..."}),(0,n.jsx)(l.$,{size:"sm",variant:"ghost",onClick:()=>J(e.id,"clientId"),children:B["".concat(e.id,"_clientId")]?(0,n.jsx)(_.A,{className:"h-3 w-3"}):(0,n.jsx)(m.A,{className:"h-3 w-3"})})]})]}),e.lastSync&&(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"最后同步:"}),(0,n.jsx)("span",{children:new Date(e.lastSync).toLocaleString()})]})]}),(0,n.jsxs)("div",{className:"flex gap-2 pt-4 border-t",children:["expired"!==e.status&&e.refreshToken?(0,n.jsxs)(l.$,{size:"sm",variant:"outline",onClick:()=>F(e),className:"flex-1",children:[(0,n.jsx)(E.A,{className:"h-4 w-4 mr-1"}),"刷新令牌"]}):(0,n.jsxs)(l.$,{size:"sm",onClick:()=>W(e),className:"flex-1",children:[(0,n.jsx)(u.A,{className:"h-4 w-4 mr-1"}),"授权访问"]}),(0,n.jsxs)(l.$,{size:"sm",variant:"outline",onClick:()=>H(e),children:[(0,n.jsx)(E.A,{className:"h-4 w-4 mr-1"}),"同步数据"]}),(0,n.jsx)(l.$,{size:"sm",variant:"outline",onClick:()=>z(e),children:(0,n.jsx)(N.A,{className:"h-4 w-4"})}),(0,n.jsx)(l.$,{size:"sm",variant:"outline",onClick:()=>$(e.id),children:(0,n.jsx)(I.A,{className:"h-4 w-4"})})]})]})})]},e.id))}),(0,n.jsx)(j.lG,{open:R,onOpenChange:U,children:(0,n.jsxs)(j.Cf,{className:"max-w-2xl",children:[(0,n.jsxs)(j.c7,{children:[(0,n.jsx)(j.L3,{children:"编辑 Google Ads 账号"}),(0,n.jsx)(j.rr,{children:"修改账号信息和 API 凭据"})]}),(0,n.jsx)(V,{}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,n.jsx)(l.$,{variant:"outline",onClick:()=>U(!1),children:"取消"}),(0,n.jsx)(l.$,{onClick:M,children:"保存更改"})]})]})}),(0,n.jsxs)(a.Zp,{className:"mt-8",children:[(0,n.jsx)(a.aR,{children:(0,n.jsx)(a.ZB,{children:"如何获取 Google Ads API 凭据"})}),(0,n.jsx)(a.Wu,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium mb-2",children:"1. Google Cloud Console"}),(0,n.jsxs)("ul",{className:"text-sm space-y-1 list-disc list-inside text-gray-600",children:[(0,n.jsx)("li",{children:"创建或选择项目"}),(0,n.jsx)("li",{children:"启用 Google Ads API"}),(0,n.jsx)("li",{children:"创建 OAuth 2.0 客户端 ID"}),(0,n.jsx)("li",{children:"设置重定向 URI"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium mb-2",children:"2. Google Ads API 中心"}),(0,n.jsxs)("ul",{className:"text-sm space-y-1 list-disc list-inside text-gray-600",children:[(0,n.jsx)("li",{children:"申请开发者令牌"}),(0,n.jsx)("li",{children:"等待审核通过"}),(0,n.jsx)("li",{children:"获取账户 ID"}),(0,n.jsx)("li",{children:"配置访问权限"})]})]})]}),(0,n.jsxs)(p.Fc,{children:[(0,n.jsx)(o.A,{className:"h-4 w-4"}),(0,n.jsx)(p.TN,{children:"所有 API 凭据都安全存储在您的本地浏览器中，不会上传到任何服务器。"})]})]})})]})]})}},38776:(e,s,t)=>{Promise.resolve().then(t.bind(t,32731))}},e=>{var s=s=>e(e.s=s);e.O(0,[2076,4121,7358],()=>s(38776)),_N_E=e.O()}]);