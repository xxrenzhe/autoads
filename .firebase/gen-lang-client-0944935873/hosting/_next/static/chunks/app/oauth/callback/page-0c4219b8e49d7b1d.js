(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2720],{33357:(e,t,s)=>{Promise.resolve().then(s.bind(s,47428))},47428:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m,dynamic:()=>x});var r=s(54568),c=s(7620),a=s(62942),n=s(63353),i=s(47227),l=s(25980),o=s(18529),d=s(90721),u=s(68267),h=s(24334);function m(){let[e,t]=(0,c.useState)("loading"),[s,m]=(0,c.useState)(""),x=(0,a.useSearchParams)();(0,c.useEffect)(()=>{f()},[]);let f=async()=>{try{let e=(0,h.d0)(),s=null==x?void 0:x.get("code"),r=null==x?void 0:x.get("state"),c=null==x?void 0:x.get("error");if(c){t("error"),m("授权失败: ".concat(c));return}if(!s||!r){t("error"),m("缺少必要的授权参数");return}let a=(await u.N.getGoogleAdsAccounts()).find(e=>e.id===r);if(!a||!a.clientId||!a.clientSecret){t("error"),m("无法获取账户配置信息");return}let n=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({code:s,client_id:a.clientId,client_secret:a.clientSecret,redirect_uri:e.oauthRedirectUri,grant_type:"authorization_code"})});if(!n.ok)throw Error("获取访问令牌失败");let i=await n.json();await u.N.updateGoogleAdsAccount(r,{refreshToken:i.refresh_token,isActive:!0}),t("success"),m("Google Ads 账户授权成功！"),setTimeout(()=>{window.close()},3e3)}catch(e){console.error("OAuth回调处理失败:",e),t("error"),m(e instanceof Error?e.message:"授权处理失败")}};return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,r.jsxs)(n.Zp,{className:"w-full max-w-md",children:[(0,r.jsxs)(n.aR,{className:"text-center",children:[(0,r.jsxs)("div",{className:"mx-auto mb-4",children:["loading"===e&&(0,r.jsx)(l.A,{className:"h-12 w-12 animate-spin text-blue-600"}),"success"===e&&(0,r.jsx)(o.A,{className:"h-12 w-12 text-green-600"}),"error"===e&&(0,r.jsx)(d.A,{className:"h-12 w-12 text-red-600"})]}),(0,r.jsxs)(n.ZB,{children:["loading"===e&&"处理授权中...","success"===e&&"授权成功","error"===e&&"授权失败"]}),(0,r.jsx)(n.BT,{children:s})]}),(0,r.jsxs)(n.Wu,{className:"text-center",children:["loading"!==e&&(0,r.jsx)(i.$,{onClick:()=>{window.close()},className:"w-full",children:"关闭窗口"}),"success"===e&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"窗口将在3秒后自动关闭"})]})]})})}let x="force-dynamic"}},e=>{var t=t=>e(e.s=t);e.O(0,[2076,4121,7358],()=>t(33357)),_N_E=e.O()}]);